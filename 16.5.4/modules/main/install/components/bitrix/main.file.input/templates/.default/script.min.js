(function(){if(!!BX.CFileInput)return;BX.CFileInput=function(e,i,t,s,l){this.ID=e;this.INPUT_NAME=i;this.CID=t;this.upload_path=s;this.multiple=!!l;this.INPUT=null;this.LIST=null;this.bInited=false;this.FILES=[];BX.CFileInput.Items[e]=this;BX.ready(BX.delegate(this.Init,this))};BX.CFileInput.Items={};BX.CFileInput.prototype.setFiles=function(e){if(!BX.type.isArray(e)){return}this.Clear();this.FILES=e;if(this.bInited){setTimeout(BX.delegate(function(){this.Callback(this.FILES,"init")},this),1)}};BX.CFileInput.prototype.Init=function(){if(this.bInited)return;this.INPUT=BX("file_input_"+this.ID);this.LIST=BX("file_input_upload_list_"+this.ID);BX.bind(this.INPUT,"change",BX.proxy(this.OnChange,this));setTimeout(BX.delegate(function(){this.bInited=true;this.Callback(this.FILES,"init")},this),1)};BX.CFileInput.prototype.CreateFileEntry=function(e,i){return BX.create("LI",{props:{className:"uploading",id:"file-"+e.fileName+"-"+i},children:[BX.create("A",{props:{href:"",target:"_blank",className:"upload-file-name"},text:e.fileName,events:{click:BX.PreventDefault}}),BX.create("SPAN",{props:{className:"upload-file-size"},children:[typeof e.fileSize!=="undefined"?"&nbsp;"+e.fileSize:null]}),BX.create("I"),BX.create("A",{props:{href:"javascript:void(0)",className:"delete-file"},events:{click:BX.proxy(this._deleteFile,this)}})]})};BX.CFileInput.prototype.OnChange=function(){var e=[];if(this.INPUT.files&&this.INPUT.files.length>0){e=this.INPUT.files}else{var i=this.INPUT.value;var t=i.replace(/.*\\(.*)/,"$1").replace(/.*\/(.*)/,"$1");e=[{fileName:t}]}var s;do{s=Math.floor(Math.random()*99999)}while(BX("iframe-"+s));if(!this.multiple){BX.cleanNode(this.LIST)}for(var l=0;l<e.length;l++){if(!e[l].fileName&&e[l].name){e[l].fileName=e[l].name}this.LIST.appendChild(this.CreateFileEntry(e[l],s))}this.Send(s)};BX.CFileInput.prototype.Send=function(e){var i="iframe-"+e;var t=BX.create("IFRAME",{props:{name:i,id:i},style:{display:"none"}});document.body.appendChild(t);var s=this.INPUT.parentNode,l=this.INPUT.name;s.removeChild(this.INPUT);this.INPUT.name="mfi_files[]";var n=BX.create("DIV");n.innerHTML='<form enctype="multipart/form-data"></form>';var a=n.firstChild;BX.adjust(a,{props:{method:"POST",action:this.upload_path,target:i},style:{display:"none"},children:[this.INPUT,BX.create("INPUT",{props:{type:"hidden",name:"sessid",value:BX.bitrix_sessid()}}),BX.create("INPUT",{props:{type:"hidden",name:"uniqueID",value:e}}),BX.create("INPUT",{props:{type:"hidden",name:"cid",value:this.CID}}),BX.create("INPUT",{props:{type:"hidden",name:"controlID",value:!!this.ID?this.ID:""}}),BX.create("INPUT",{props:{type:"hidden",name:"mfi_mode",value:"upload"}})]});BX.onCustomEvent(this,"onSubmit",[]);window["FILE_UPLOADER_CALLBACK_"+e]=BX.proxy(this.Callback,this);document.body.appendChild(n);BX.submit(a,"mfi_save","Y",BX.delegate(function(){this.INPUT.name=l;BX.unbind(this.INPUT,"change",BX.proxy(this.OnChange,this));this.INPUT=s.appendChild(BX.create("INPUT",{attrs:{name:l,id:this.INPUT.id,type:"file",size:"1",multiple:"multiple"}}));BX.bind(this.INPUT,"change",BX.proxy(this.OnChange,this));BX.cleanNode(n,true);if(!this.multiple){this.INPUT.disabled=true}},this))};BX.CFileInput.prototype.Clear=function(){if(this.LIST){while(this.LIST.childNodes.length>0){this.LIST.removeChild(this.LIST.childNodes[0])}}this.FILES=[]};BX.CFileInput.prototype.Callback=function(e,i){if(!this.bInited){this.Init();return}BX.show(this.LIST);var t=false,s;for(var l=0;l<e.length;l++){var n=BX("file-"+e[l].fileName+"-"+i);if(!n){n=this.LIST.appendChild(this.CreateFileEntry(e[l],i+Math.random()))}if(e[l].fileID){BX.removeClass(n,"uploading");BX.addClass(n,"saved");BX.adjust(n.firstChild,{props:{href:e[l].fileURL}});BX.adjust(n.firstChild.nextSibling,{html:"&nbsp;"+e[l].fileSize});BX.unbindAll(n.firstChild);BX.unbindAll(n.lastChild);BX.bind(n.lastChild,"click",BX.proxy(this._deleteFile,this));s=BX.create("INPUT",{props:{type:"hidden",name:this.INPUT_NAME+(this.multiple?"[]":""),value:e[l].fileID}});n.appendChild(s);BX.onCustomEvent(this,"onAddFile",[e[l].fileID,this,e[l],s])}else{BX.onCustomEvent(this,"onErrorFile",[e[l],this]);t=true;BX.cleanNode(n,true)}}BX.onCustomEvent(this,"onDone",[e,i,t,this]);if(this.LIST.childNodes.length<=0)this.INPUT.disabled=false;window["FILE_UPLOADER_CALLBACK_"+i]=null;BX.cleanNode(BX("iframe-"+i),true);BX.onCustomEvent(this,"onFileUploaderChange",[e,this])};BX.CFileInput.prototype._deleteFile=function(e){if(!e)return false;var i=BX(e)?BX(e).previousSibling:BX.proxy_context,t;var s=BX.hasClass(i.parentNode,"saved");if(!s||confirm(BX.message("MFI_CONFIRM"))){t=i.nextSibling.value;if(s){var l={fileID:i.nextSibling.value,sessid:BX.bitrix_sessid(),cid:this.CID,controlID:!!this.ID?this.ID:"",mfi_mode:"delete"};BX.ajax.post(this.upload_path,l)}BX.remove(i.parentNode);BX.onCustomEvent(this,"onDeleteFile",[t,this]);BX.onCustomEvent(this,"onFileUploaderChange",[[t],this])}if(this.LIST.childNodes.length<=0)this.INPUT.disabled=false;BX.PreventDefault(e)}})();
//# sourceMappingURL=script.map.js