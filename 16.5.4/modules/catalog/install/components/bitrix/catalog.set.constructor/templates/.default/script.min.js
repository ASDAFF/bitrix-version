BX.namespace("BX.Catalog.SetConstructor");BX.Catalog.SetConstructor=function(){var t=function(t){this.numSliderItems=t.numSliderItems||0;this.numSetItems=t.numSetItems||0;this.jsId=t.jsId||"";this.ajaxPath=t.ajaxPath||"";this.currency=t.currency||"";this.lid=t.lid||"";this.iblockId=t.iblockId||"";this.basketUrl=t.basketUrl||"";this.setIds=t.setIds||null;this.offersCartProps=t.offersCartProps||null;this.itemsRatio=t.itemsRatio||null;this.noFotoSrc=t.noFotoSrc||"";this.messages=t.messages;this.mainElementPrice=t.mainElementPrice||0;this.mainElementOldPrice=t.mainElementOldPrice||0;this.mainElementDiffPrice=t.mainElementDiffPrice||0;this.mainElementBasketQuantity=t.mainElementBasketQuantity||1;this.parentCont=BX(t.parentContId)||null;this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']");this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']");this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']");this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']");this.setDiffPriceCont=this.parentCont.querySelector("[data-role='set-diff-price']");this.notAvailProduct=this.sliderItemsCont.querySelector("[data-not-avail='yes']");this.emptySetMessage=this.parentCont.querySelector("[data-set-message='empty-set']");BX.bindDelegate(this.setItemsCont,"click",{attribute:"data-role"},BX.proxy(this.deleteFromSet,this));BX.bindDelegate(this.sliderItemsCont,"click",{attribute:"data-role"},BX.proxy(this.addToSet,this));var e=this.parentCont.querySelector("[data-role='set-buy-btn']");BX.bind(e,"click",BX.proxy(this.addToBasket,this));this.generateSliderStyles()};t.prototype.generateSliderStyles=function(){var t=BX.create("style",{html:".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+this.numSliderItems*25+"%;}"+".bx-catalog-set-item-container-"+this.jsId+"{width: "+100/this.numSliderItems+"%;}"+"@media (max-width:767px){"+".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+this.numSliderItems*20*2+"%;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});if(BX("bx-set-const-style-"+this.jsId)){BX.remove(BX("bx-set-const-style-"+this.jsId))}this.parentCont.appendChild(t)};t.prototype.deleteFromSet=function(){var t=BX.proxy_context,e,a,i,s,r,d,n,l,c,o,m,h,u,p,b;if(t&&t.hasAttribute("data-role")&&t.getAttribute("data-role")=="set-delete-btn"){e=t.parentNode.parentNode;a=e.getAttribute("data-id");i=e.getAttribute("data-name");s=e.getAttribute("data-url");r=e.getAttribute("data-img");d=e.getAttribute("data-print-price");n=e.getAttribute("data-price");l=e.getAttribute("data-print-old-price");c=e.getAttribute("data-old-price");o=e.getAttribute("data-diff-price");m=e.getAttribute("data-measure");h=e.getAttribute("data-quantity");b=BX.create("div",{attrs:{className:"bx-catalog-set-item-container bx-catalog-set-item-container-"+this.jsId,"data-id":a,"data-img":r?r:"","data-url":s,"data-name":i,"data-print-price":d,"data-print-old-price":l,"data-price":n,"data-old-price":c,"data-diff-price":o,"data-measure":m,"data-quantity":h},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img-container"},children:[BX.create("img",{attrs:{src:r?r:this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-title"},children:[BX.create("a",{attrs:{href:s},html:i})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-price-new"},html:d+" * "+h+m}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price-old"},html:n!=c?l:""})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-add-btn"},children:[BX.create("a",{attrs:{className:"btn btn-add btn-sm","data-role":"set-add-btn"},html:this.messages.ADD_BUTTON})]})]})]});if(!!this.notAvailProduct)this.sliderItemsCont.insertBefore(b,this.notAvailProduct);else this.sliderItemsCont.appendChild(b);this.numSliderItems++;this.numSetItems--;this.generateSliderStyles();BX.remove(e);for(u=0,p=this.setIds.length;u<p;u++){if(this.setIds[u]==a)this.setIds.splice(u,1)}this.recountPrice();if(this.numSetItems<=0&&!!this.emptySetMessage)BX.adjust(this.emptySetMessage,{style:{display:"inline-block"},html:this.messages.EMPTY_SET})}};t.prototype.addToSet=function(){var t=BX.proxy_context,e,a,i,s,r,d,n,l,c,o,m,h,u;if(!!t&&t.hasAttribute("data-role")&&t.getAttribute("data-role")=="set-add-btn"){e=t.parentNode.parentNode.parentNode;a=e.getAttribute("data-id");i=e.getAttribute("data-name");s=e.getAttribute("data-url");r=e.getAttribute("data-img");d=e.getAttribute("data-print-price");n=e.getAttribute("data-price");l=e.getAttribute("data-print-old-price");c=e.getAttribute("data-old-price");o=e.getAttribute("data-diff-price");m=e.getAttribute("data-measure");h=e.getAttribute("data-quantity");u=BX.create("tr",{attrs:{"data-id":a,"data-img":r?r:"","data-url":s,"data-name":i,"data-print-price":d,"data-print-old-price":l,"data-price":n,"data-old-price":c,"data-diff-price":o,"data-measure":m,"data-quantity":h},children:[BX.create("td",{attrs:{className:"bx-added-item-table-cell-img"},children:[BX.create("img",{attrs:{src:r?r:this.noFotoSrc,className:"img-responsive"}})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-itemname"},children:[BX.create("a",{attrs:{href:s,className:"tdn"},html:i})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-price"},children:[BX.create("span",{attrs:{className:"bx-added-item-new-price"},html:d+" * "+h+m}),BX.create("br"),BX.create("span",{attrs:{className:"bx-added-item-old-price"},html:n!=c?l:""})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-del"},children:[BX.create("div",{attrs:{className:"bx-added-item-delete","data-role":"set-delete-btn"}})]})]});this.setItemsCont.appendChild(u);this.numSliderItems--;this.numSetItems++;this.generateSliderStyles();BX.remove(e);this.setIds.push(a);this.recountPrice();if(this.numSetItems>0&&!!this.emptySetMessage)BX.adjust(this.emptySetMessage,{style:{display:"none"},html:""})}};t.prototype.recountPrice=function(){var t=this.mainElementPrice*this.mainElementBasketQuantity,e=this.mainElementOldPrice*this.mainElementBasketQuantity,a=this.mainElementDiffPrice*this.mainElementBasketQuantity,i=BX.findChildren(this.setItemsCont,{tagName:"tr"},true),s,r,d;if(i){for(s=0,r=i.length;s<r;s++){d=Number(i[s].getAttribute("data-quantity"))||1;t+=Number(i[s].getAttribute("data-price"))*d;e+=Number(i[s].getAttribute("data-old-price"))*d;a+=Number(i[s].getAttribute("data-diff-price"))*d}}this.setPriceCont.innerHTML=BX.Currency.currencyFormat(t,this.currency,true);if(Math.floor(a*100)>0){this.setOldPriceCont.innerHTML=BX.Currency.currencyFormat(e,this.currency,true);this.setDiffPriceCont.innerHTML=BX.Currency.currencyFormat(a,this.currency,true)}else{this.setOldPriceCont.innerHTML="";this.setDiffPriceCont.innerHTML=""}};t.prototype.addToBasket=function(){var t=BX.proxy_context;BX.showWait(t.parentNode);BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(t){BX.closeWait();document.location.href=this.basketUrl},this))};return t}();
//# sourceMappingURL=script.map.js