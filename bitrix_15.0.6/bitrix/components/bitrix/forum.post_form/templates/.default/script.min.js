(function(){if(BX.Forum&&BX.Forum.transliterate)return;BX.Forum=BX.Forum?BX.Forum:{};var e={};BX.Forum.transliterate=function(e){e.onblur=function(){clearInterval(e.bxfInterval)};e.bxfInterval=setInterval(function(){if(e.value!=e.bxValue){e.bxValue=e.value;BX.translit(e.value,{max_len:70,change_case:"L",replace_space:"-",replace_other:"",delete_repeat_replace:true,use_google:true,callback:function(t){e.nextSibling.value=t}})}},500)};BX.Forum.AddTags=function(e){if(e&&e.parentNode){var t=e.parentNode.parentNode.previousSibling,r=e.parentNode.parentNode;BX.show(t);BX.remove(e.parentNode);if(r.innerHTML==="")BX.remove(r);var a=t.getElementsByTagName("INPUT");for(var i=0;i<a.length;i++){if(a[i].type.toUpperCase()=="TEXT"){BX.Forum.CorrectTags(a[i]);a[i].focus();break}}}return false};BX.Forum.CorrectTags=function(e){if(BX("TAGS_div_frame"))BX("TAGS_div_frame").id=e.id+"_div_frame"};var t=function(e){var t=BX.create("div");t.innerHTML=e;if(t.childNodes.length>0)return t.childNodes[0];else return null},r=function(e){var r=BX.findChild(document,{className:"forum-note-box"},true,true),a;if(r){for(a=0;a<r.length;a++){BX.remove(r[a])}}var i=BX.findChildren(document,{className:"forum-block-container"},true);if(!i||i.length<1)return;var n=i[i.length-1];if(e.length<1)return;var o=t(e);if(!o)return;var s=["forum-info-box","forum-header-box","forum-reply-form"];var l=n;while((l=l.nextSibling)&&!!l){if(l.nodeType==1){var d=false;for(a in s){if(s.hasOwnProperty(a)&&BX.hasClass(l,s[a])){d=true;break}}if(d){l.parentNode.insertBefore(o,l);break}}}},a=function(e,r){var a=t(e),i;if(!a)return;var n=BX.findChildren(document,{className:"forum-navigation-box"},true);if(!n)return;for(i=0;i<n.length;i++)n[i].innerHTML=a.innerHTML;window["oForum"]["page_number"]=r},i=function(e){var r=t(e);if(!r)return;var a=BX.findChild(document,{className:"forum-navigation-box"},true);if(!a)return;a.parentNode.insertBefore(r,a)},n=function(e,r,a,i){var n=null;if(!BX.type.isDomNode(a))return false;if(!BX.type.isDomNode(e)&&!BX.type.isArray(e)&&e.length>0)if(!(e=t(e)))return false;if(BX.type.isDomNode(r)){n=r.nextSibling;r.parentNode.removeChild(r)}if(!n)n=BX.findChild(a,i,true);if(n){n.parentNode.insertBefore(e,n)}else{a.appendChild(e)}return true},o=function(e){var t=BX.processHTML(e,true);BX.ajax.processScripts(t.SCRIPT,true)},s=function(e,t){t["BXFormSubmit_save"]=null;var s=window.forumAjaxPostTmp;if(typeof s=="undefined"){BX.reload();return}var d=BX.findChildren(document,{className:"forum-block-inner"},true);if(!d||d.length<1)BX.reload();var f,u=d[d.length-1],m=BX.findChild(u,{tagName:"form",className:"forum-form"},true);u=!!m?m:u;if(s.status){if(s["allMessages"]){if(!s.message)return;var c=u.parentNode;BX.remove(u);c.innerHTML+=s.message;if(!!s.navigation&&!!s.pageNumber){a(s.navigation,s.pageNumber)}if(!!s["messageStart"]){i(s["messageStart"])}l(t);o(s.message)}else if(typeof s.message!="undefined"){var p=BX.findChildren(u,{tagName:"table",className:"forum-post-table"},true);if(p.length>0){var g=p[p.length-1],h=BX.findChild(g,{tagName:"tfoot"},true);if(h)BX.remove(h)}u.innerHTML+=s.message;l(t);o(s.message)}else if(s["previewMessage"]){var B=BX.findChild(document,{className:"forum-preview"},true),v=BX.findChild(document,{className:"forum_post_form"},true).parentNode;n(s["previewMessage"],B,v,{className:"forum_post_form"});r("");o(s["previewMessage"])}if(!!s["messageID"])if((f=BX("message"+s["messageID"]))&&!!f)BX.scrollToNode(f)}var X=t.getElementsByTagName("input");for(var _=0;_<X.length;_++){var w=X[_];if(w.getAttribute("type")=="submit")w.disabled=false}BX.remove(BX.findChild(t,{attr:{name:"pageNumber"}},true));if(s["statusMessage"])r(s["statusMessage"])},l=function(e){window.LHEPostForm.reinitDataBefore("POST_MESSAGE");var t=LHEPostForm.getEditor("POST_MESSAGE"),r,a=LHEPostForm.getHandler("POST_MESSAGE");if(t){t.CheckAndReInit("");if(t.fAutosave)BX.bind(t.pEditorDocument,"keydown",BX.proxy(t.fAutosave.Init,t.fAutosave));for(var i in a.arFiles){if(a.arFiles.hasOwnProperty(i)){if((r=BX("file-doc"+a.arFiles[i]["id"]))&&!!r){BX.remove(r);BX.hide(BX("wd-doc"+a.arFiles[i]["id"]));BX.remove(BX("filetoupload"+a.arFiles[i]["id"]))}}}}if(!BX.type.isDomNode(e))return;if((r=BX.findChild(document,{className:"forum-preview"},true))&&!!r)BX.remove(r);var n=BX.findChild(e,{tagName:"TR",className:"error-load"},true,true),o=null;if(n)while((o=n.pop())&&!!o)BX.hide(o);var s=null,l=BX.findChild(e,{attr:{name:"captcha_code"}},true),d=BX.findChild(e,{attr:{name:"captcha_word"}},true),f=BX.findChild(e,{className:"forum-reply-field-captcha-image"},true);if(f)s=BX.findChild(f,{tag:"img"});if(l&&d&&s){d.value="";BX.ajax.getCaptcha(function(e){l.value=e["captcha_sid"];s.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}};BX.Forum.SetForumAjaxPostTmp=function(e){window.forumAjaxPostTmp=e};BX.Forum.ValidateForm=function(e,t){if(e["BXFormSubmit_save"])return true;var r=window["BXHtmlEditor"]?window["BXHtmlEditor"].Get("POST_MESSAGE"):false;if(typeof e!="object"||!e["POST_MESSAGE"]||!r)return false;if(typeof window["oForum"]=="undefined")window["oForum"]={};r.SaveContent();var a="",i=r.GetContent(),n=i.length,o=64e3;if(e.TITLE&&e.TITLE.value.length<=0)a+=BX.message("no_topic_name");if(n<=0)a+=BX.message("no_message");else if(n>o)a+=BX.message("max_len").replace(/#MAX_LENGTH#/gi,o).replace(/#LENGTH#/gi,n);if(a!==""){alert(a);return false}if(e["FILES[]"]){var l=[],d=BX.type.isDomNode(e["FILES[]"])?e["FILES[]"]:e["FILES[]"][0],f=BX.type.isDomNode(e["FILES[]"])?false:0;do{if(!BX("filetoupload"+d.value)){l.push(BX.adjust(BX.clone(d),{attrs:{name:"FILES_TO_UPLOAD[]",id:"filetoupload"+d.value}}))}d=f===false?false:f<e["FILES[]"].length?e["FILES[]"][f++]:false}while(!!d);while(l.length>0)e.appendChild(l.pop())}var u=e.getElementsByTagName("input");for(var m=0;m<u.length;m++){var c=u[m];if(c.getAttribute("type")=="submit")c.disabled=true}if(t=="Y"){var p=e;if(typeof window["oForum"]!="undefined"&&typeof window["oForum"]["page_number"]!="undefined"){var g=BX.findChild(p,{attr:{name:"pageNumber"}});if(!g){g=BX.create("input",{props:{type:"hidden",name:"pageNumber"}});g.value=window["oForum"]["page_number"];p.appendChild(g)}else{g.value=window["oForum"]["page_number"]}}setTimeout(function(){BX.ajax.submit(p,function(e){s(e,p)})},50);return false}return true};BX.Forum.ShowLastEditReason=function(e,t){if(t&&e)BX.show(t);else if(t)BX.hide(t)};BX.Forum.ShowVote=function(e){var t=e.parentNode.parentNode;BX.remove(e.parentNode);if(t.innerHTML==="")BX.remove(t);BX.show(BX("vote_params"));return false};window.vote_remove_answer=function(e){if(typeof e!="object"||e===null)return false;vote_add_answer(e.parentNode.parentNode.parentNode,true);var t=e.parentNode.parentNode.firstChild,r=/ANS_(\d+)__(\d+)_/i,a=r.exec(t.parentNode.id),i=parseInt(a[1]),n=parseInt(a[2]);if(t.value!==""&&!confirm(BX.message("vote_drop_answer_confirm")))return false;if(t.form["ANSWER_DEL["+i+"]["+n+"]"])t.form["ANSWER_DEL["+i+"]["+n+"]"].value="Y";t.parentNode.parentNode.removeChild(t.parentNode);return false};window.vote_add_answer=function(e,t){if(!e||typeof e!="object")return false;var r=t!==true?e.parentNode.parentNode:e,a=r.lastChild.previousSibling?/ANS_(\d+)__(\d+)_/i:/addA(\d+)/i,i=a.exec(r.lastChild.previousSibling?r.lastChild.previousSibling.id:e.name),n=parseInt(i[1]),o=parseInt(i[2]);if(!window["__fqan"+n])window["__fqan"+n]=o+1;if(t!==true){o=window["__fqan"+n]++;var s=BX.create("DIV",{html:window["arVoteParams"]["template_answer"].replace(/#Q#/g,n).replace(/#A#/g,o)});r.insertBefore(s.firstChild,r.lastChild)}return false};window.vote_remove_question=function(e){if(typeof e!="object"||e===null)return false;var t=e.parentNode.previousSibling,r=parseInt(t.id.replace("QUESTION_",""));if(t.value!==""&&!confirm(BX.message("vote_drop_question_confirm")))return false;if(t.form["QUESTION_DEL["+r+"]"])t.form["QUESTION_DEL["+r+"]"].value="Y";t.parentNode.parentNode.parentNode.removeChild(t.parentNode.parentNode);return false};window.vote_add_question=function(e,t){if(!window["__fqn"])window["__fqn"]=parseInt(t)+1;t=window["__fqn"]++;var r=BX.create("DIV",{html:window["arVoteParams"]["template_question"].replace(/#Q#/g,t)});e.parentNode.insertBefore(r.firstChild,e);return false};window.quoteMessageEx=function(e){var t=window["BXHtmlEditor"]?window["BXHtmlEditor"].Get("POST_MESSAGE"):false,r="";if(!(t&&t.toolbar.controls.Quote))return false;var a=t.selection.GetRange(t.selection.GetSelection(document));if(a&&!a.collapsed){var i=BX.create("DIV",{html:a.toHtml()});t.GetIframeDoc();r=t.util.GetTextContentEx(i);BX.remove(i)}if(r!=="")BX.DoNothing();else if(e>0)r=BX("message_text_"+e,true)?BX("message_text_"+e,true).innerHTML:"";else if(e.length>0)r=e;r=r.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n");if(r!==""){var n=function(e,t){var r=" ",a=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi,i=a.exec(t);if(i)r="[VIDEO WIDTH="+i[2]+" HEIGHT="+i[3]+"]"+i[1]+"[/VIDEO]";if(r==" "){var n=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;i=n.exec(t);if(i)r="[VIDEO WIDTH="+i[3]+" HEIGHT="+i[2]+"]"+i[1]+"[/VIDEO]"}return r};r=r.replace(/<script[^>]*>/gi,"").replace(/<\/script[^>]*>/gi,"");r=r.replace(/\001([^\002]*)\002/gi,n);r=r.replace(/<noscript[^>]*>/gi,"").replace(/<\/noscript[^>]*>/gi,"");r=r.replace(/\003([^\004]*)\004/gi," ");r=r.replace(/<table class=["]*forum-quote["]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"");r=r.replace(/<table class=["]*forum-code["]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"");r=r.replace(/<table class=["]*data-table["]*>[^<]*<tbody>/gi,"");r=r.replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,"");r=r.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");var o=0;while(o++<50&&(r.search(/\002([^\002\003]*)\003/gi)>=0||r.search(/\001([^\001\003]*)\003/gi)>=0)){r=r.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]")}var s=function(e,t,r){var a=new RegExp("([^]*)("+t+")([^]*)","i");var i=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i");var n=0;while(n++<300&&e.search(a)>=0)e=e.replace(i,"$1"+r+"$3");return e};o=0;while(o++<10&&r.search(/\004([^\004\003]*)\003/gi)>=0){r=s(r,"<tr>","[TR]");r=s(r,"</tr>","[/TR]");r=s(r,"<td>","[TD]");r=s(r,"</td>","[/TD]");r=r.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]")}r=r.replace(/[\001\002\003\004]/gi,"");if(BX.browser.IsIE())r=r.replace(/<img(?:(?:\s+alt\s*=\s*"?smile([^"\s]+)"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1");else r=r.replace(/<img(.*?)alt=["]*smile([^"\s]+)["]*[^>]*>/gi,"$2");r=r.replace(/<img(.+?)data-code="(.+?)"(.+?)>/gi,"$2");r=r.replace(/<a[^>]+href=["]([^"]+)"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]").replace(/<a[^>]+href=[']([^']+)'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]").replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"').replace(/(smile(?=[:;8]))/g,"").replace(/&shy;/gi,"").replace(/&nbsp;/gi," ");if(!!t&&!!r){var l;if(e>0){if(BX("message_block_"+e,true)&&BX("message_block_"+e,true).hasAttribute("bx-author-name")){l={name:BX("message_block_"+e,true).getAttribute("bx-author-name"),id:BX("message_block_"+e,true).getAttribute("bx-author-id")}}}if(t.GetViewMode()=="code"&&t.bbCode){if(!l)l="";else if(l.id>0)l="[USER="+l.id+"]"+l.name+"[/USER]";else l=l.name;l=l!==""?l+BX.message("MPL_HAVE_WRITTEN")+"\n":"";r=l+r}else if(t.GetViewMode()=="wysiwyg"){if(!l)l="";else if(l.id>0)l='<span id="'+t.SetBxTag(false,{tag:"postuser",params:{value:l.id}})+'" style="color: #2067B0; border-bottom: 1px dashed #2067B0;">'+l.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";else l="<span>"+l.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";r=(l!==""?l+BX.message("MPL_HAVE_WRITTEN")+"<br>":"")+t.ParseContentFromBbCode(r)}t.action.actions.quote.setExternalSelection(r);t.action.Exec("quote");if(t.fAutosave)BX.bind(t.pEditorDocument,"keydown",BX.proxy(t.fAutosave.Init,t.fAutosave))}}return false};window.reply2author=function(e){var t="";if(e>0&&BX("message_block_"+e,true)&&BX("message_block_"+e,true).hasAttribute("bx-author-name")){t={name:BX("message_block_"+e,true).getAttribute("bx-author-name"),id:BX("message_block_"+e,true).getAttribute("bx-author-id")}}var r=window["BXHtmlEditor"]?window["BXHtmlEditor"].Get("POST_MESSAGE"):false;if(!!r&&!!t){if(r.GetViewMode()=="code"&&r.bbCode){t=t.id>0?"[USER="+t.id+"]"+t.name+"[/USER]":t.name;r.textareaView.WrapWith("",", ",t)}else if(r.GetViewMode()=="wysiwyg"){t=t.id>0?'<span id="'+r.SetBxTag(false,{tag:"postuser",params:{value:t.id}})+'" style="color: #2067B0; border-bottom: 1px dashed #2067B0;">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>":"<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";r.InsertHtml(t+", ")}r.Focus();BX.defer(r.Focus,r)()}return false};BX.Forum.Init=function(e){if(!e||typeof e!="object")return;if(BX.message("LANGUAGE_ID")=="ru"){BX.addCustomEvent(window,"OnEditorInitedBefore",function(e){e.AddButton({id:"translit",name:"Translit",iconClassName:"bxhtmled-button-translit",disabledForTextarea:false,toolbarSort:205,handler:function(){var t=function(t){if(typeof e.bTranslited=="undefined")e.bTranslited=false;var r=[],a=0;function i(e,t,a,i){r.push(t);return""}function n(e,t,a,i){return r.shift()}var o=new RegExp("(\\[[^\\]]*\\])","gi");t=t.replace(o,i);if(e.bTranslited==false){for(a=0;a<capitEngLettersReg.length;a++)t=t.replace(capitEngLettersReg[a],capitRusLetters[a]);for(a=0;a<smallEngLettersReg.length;a++)t=t.replace(smallEngLettersReg[a],smallRusLetters[a]);e.bTranslited=true}else{for(a=0;a<capitRusLetters.length;a++)t=t.replace(capitRusLettersReg[a],capitEngLetters[a]);for(a=0;a<smallRusLetters.length;a++)t=t.replace(smallRusLettersReg[a],smallEngLetters[a]);e.bTranslited=false}t=t.replace(new RegExp("","g"),n);return t};e.SaveContent();var r=t(e.GetContent());BX.defer(function(){e.SetContent(r)})()}})})}BX.addCustomEvent(window,"OnEditorInitedAfter",function(t){t.insertImageAfterUpload=true;BX.bind(BX("post_message_hidden"),"focus",function(){t.Focus()});var r=e["formID"],a=document.forms[r];BX.bind(a,"submit",function(t){if(!BX.Forum.ValidateForm(a,e["ajaxPost"]))BX.PreventDefault(t)});BX.addCustomEvent(t,"OnCtrlEnter",function(t){if(BX.Forum.ValidateForm(a,e["ajaxPost"]))BX.submit(a)});if(e["captcha"]=="Y"){var i=new d(a);BX.addCustomEvent(t,"OnContentChanged",BX.proxy(i.Show,i));BX.ready(function(){BX.bind(BX("forum-refresh-captcha"),"click",BX.proxy(i.Update,i))});if(e["bVarsFromForm"]=="Y")i.Show()}})};var d=function(e){if(e==null)return false;this.div=BX.findChild(e,{className:"forum-reply-field-captcha"},true);this.input=BX.findChild(e,{attr:{name:"captcha_word"}},true);this.hidden=BX.findChild(e,{attr:{name:"captcha_code"}},true);this.image=BX.findChild(this.div,{tag:"img"},true);return this};d.prototype={Show:function(e,t){if(e!==""||t!==""){function r(e){var t=e.style.display||BX.style(e,"display");return t!="none"}if(!r(this.div)){BX.show(this.div);this.Update()}}},UpdateControls:function(e){this.input.value="";this.hidden.value=e["captcha_sid"];this.image.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]},Update:function(){BX.ajax.getCaptcha(BX.proxy(this.UpdateControls,this))}}})();
//# sourceMappingURL=script.map.js