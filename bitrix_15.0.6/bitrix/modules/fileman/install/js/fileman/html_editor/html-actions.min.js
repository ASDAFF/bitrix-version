(function(){function e(e){this.editor=e;this.document=e.sandbox.GetDocument();BX.addCustomEvent(this.editor,"OnIframeReInit",BX.proxy(function(){this.document=this.editor.sandbox.GetDocument()},this));this.actions=this.GetActionList();this.contentActionIndex={removeFormat:1,bold:1,italic:1,underline:1,strikeout:1,fontSize:1,foreColor:1,backgroundColor:1,formatInline:1,formatBlock:1,createLink:1,insertHTML:1,insertImage:1,insertLineBreak:1,removeLink:1,insertOrderedList:1,insertUnorderedList:1,align:1,indent:1,outdent:1,formatStyle:1,fontFamily:1,universalFormatStyle:1,quote:1,code:1,sub:1,sup:1,insertSmile:1}}e.prototype={IsSupportedByBrowser:function(e){var t=BX.browser.IsIE()||BX.browser.IsIE10()||BX.browser.IsIE11(),n={indent:t,outdent:t,formatBlock:t,insertUnorderedList:BX.browser.IsIE()||BX.browser.IsOpera(),insertOrderedList:BX.browser.IsIE()||BX.browser.IsOpera()},r={insertHTML:BX.browser.IsFirefox()};if(!n[e]){try{return this.document.queryCommandSupported(e)}catch(i){}try{return this.document.queryCommandEnabled(e)}catch(o){return!!r[e]}}return false},IsSupported:function(e){return!!this.actions[e]},IsContentAction:function(e){return this.contentActionIndex[e]},Exec:function(e,t,n){var r=this,i=this.actions[e],o=i&&i.exec,a=this.IsContentAction(e),l=null;if(!n){this.editor.On("OnBeforeCommandExec",[a,e,i])}if(a){this.editor.Focus(false)}if(o){l=o.apply(i,arguments)}else{try{l=this.document.execCommand(e,false,t)}catch(s){}}if(a){setTimeout(function(){r.editor.Focus(false)},1)}if(!n){this.editor.On("OnAfterCommandExec",[a,e])}return l},CheckState:function(e,t){var n=this.actions[e],r=null;if(n&&n.state){r=n.state.apply(n,arguments)}else{try{r=this.document.queryCommandState(e)}catch(i){r=false}}return r},GetValue:function(e){var t=this.commands[e],n=t&&t.value;if(n){return n.call(t,this.composer,e)}else{try{return this.document.queryCommandValue(e)}catch(r){return null}}},GetActionList:function(){this.actions={changeView:this.GetChangeView(),splitMode:this.GetChangeSplitMode(),fullscreen:this.GetFullscreen(),changeTemplate:this.GetChangeTemplate(),removeFormat:this.GetRemoveFormat(),bold:this.GetBold(),italic:this.GetItalic(),underline:this.GetUnderline(),strikeout:this.GetStrikeout(),fontSize:this.GetFontSize(),foreColor:this.GetForeColor(),backgroundColor:this.GetBackgroundColor(),formatInline:this.GetFormatInline(),formatBlock:this.GetFormatBlock(),createLink:this.GetCreateLink(),insertHTML:this.GetInsertHTML(),insertImage:this.GetInsertImage(),insertLineBreak:this.GetInsertLineBreak(),insertTable:this.GetInsertTable(),removeLink:this.GetRemoveLink(),insertOrderedList:this.GetInsertList({bOrdered:true}),insertUnorderedList:this.GetInsertList({bOrdered:false}),align:this.GetAlign(),indent:this.GetIndent(),outdent:this.GetOutdent(),formatStyle:this.GetFormatStyle(),fontFamily:this.GetFontFamily(),universalFormatStyle:this.GetUniversalFormatStyle(),selectNode:this.GetSelectNode(),doUndo:this.GetUndoRedo(true),doRedo:this.GetUndoRedo(false),sub:this.GetSubSup("sub"),sup:this.GetSubSup("sup"),quote:this.GetQuote(),code:this.GetCode(),insertSmile:this.GetInsertSmile(),tableOperation:this.GetTableOperation(),formatBbCode:this.GetFormatBbCode()};this.editor.On("OnGetActionsList");return this.actions},GetChangeView:function(){var e=this;return{exec:function(){var t=arguments[1];if({code:1,wysiwyg:1,split:1}[t])e.editor.SetView(t)},state:function(){return false},value:function(){}}},GetChangeSplitMode:function(){var e=this;return{exec:function(){e.editor.SetSplitMode(arguments[1]==1)},state:function(){return e.editor.GetSplitMode()},value:function(){}}},GetFullscreen:function(){var e=this;return{exec:function(){e.editor.Expand()},state:function(){return e.editor.IsExpanded()},value:function(){}}},GetFormatInline:function(){var e=this,t={strong:"b",em:"i",b:"strong",i:"em"},n={};function r(e,t,n){var r=e+":";if(n)r+=n;if(t){for(var i in t)if(t.hasOwnProperty(i))r+=i+"="+t[i]+";"}return r}function i(i,o,a){var l=r(i,o,a);if(!n[l]){var s=t[i];var d=s?[i.toLowerCase(),s.toLowerCase()]:[i.toLowerCase()];n[l]=new e.editor.HTMLStyler(e.editor,d,o,a,true)}return n[l]}return{exec:function(t,n,r,o,a,l){l=!l||typeof l!="object"?{}:l;e.editor.iframeView.Focus();var s=e.editor.selection.GetRange();if(!s){return false}var d=i(r,o,a);if(l.bClear){s=d.UndoToRange(s,false)}else{s=d.ToggleRange(s)}setTimeout(function(){e.editor.selection.SetSelection(s);var t=e.editor.selection.GetSelectedNode();if(t&&t.nodeType==1){e.editor.lastCreatedId=Math.round(Math.random()*1e6);t.setAttribute("data-bx-last-created-id",e.editor.lastCreatedId)}},10)},state:function(n,r,o,a,l){var s=e.editor.GetIframeDoc(),d=t[o]||o;if(!e.editor.util.DocumentHasTag(s,o)&&(o!=d&&!e.editor.util.DocumentHasTag(s,d))){return false}var f=e.editor.selection.GetRange();if(!f){return false}var c=i(o,a,l);return c.IsAppliedToRange(f,false)},value:BX.DoNothing}},GetFormatBlock:function(){var e=this,t="DIV",n=e.editor.GetBlockTags(),r=e.editor.NESTED_BLOCK_TAGS;function i(e,t,n){if(e.className){o(e,n);e.className+=" "+t}else{e.className=t}}function o(e,t){e.className=e.className.replace(t,"")}function a(t){var n=e.editor.util.GetNextNotEmptySibling(t),r=e.editor.util.GetPreviousNotEmptySibling(t);if(n&&!d(n)){t.parentNode.insertBefore(e.document.createElement("BR"),n)}if(r&&!d(r)){t.parentNode.insertBefore(e.document.createElement("BR"),t)}}function l(t){var n=e.editor.util.GetNextNotEmptySibling(t),r=e.editor.util.GetPreviousNotEmptySibling(t);if(n&&n.nodeName==="BR"){n.parentNode.removeChild(n)}if(r&&r.nodeName==="BR"){r.parentNode.removeChild(r)}}function s(e){var t=e.lastChild;if(t&&t.nodeName==="BR"){t.parentNode.removeChild(t)}}function d(t){return t.nodeName==="BR"||e.editor.util.IsBlockElement(t)}function f(t,n,r,i){if(r||i){}e.document.execCommand(t,false,n)}function c(e){return!e.className||BX.util.trim(e.className)===""}function u(t,n,r,i){if(n){if(t.nodeName!==n){t=e.editor.util.RenameNode(t,n)}if(r){BX.addClass(t,r)}if(i&&i.length>0){e.editor.util.SetCss(t,i)}}else{a(t);e.editor.util.ReplaceWithOwnChildren(t)}}return{exec:function(i,o,d,f,c){c=c||{};o=typeof o==="string"?o.toUpperCase():o;var m,h,g,N,p=c.range||e.editor.selection.GetRange(),v=o?e.actions.formatBlock.state(i,o,d,f):false,B;if(c.range)e.editor.selection.RestoreBookmark();if(v){if(BX.util.in_array(o,r)){v=e.document.createElement(o||t);if(d){v.className=d}e.editor.selection.Surround(v);e.editor.selection.SelectNode(v)}else{e.editor.util.SetCss(v,f);setTimeout(function(){e.editor.selection.SelectNode(v)},10)}}else{if(o===null||BX.util.in_array(o,n)){v=false;B=e.editor.selection.GetSelectedNode();if(B){if(B.nodeType==1&&BX.util.in_array(B.nodeName,n)){v=B}else{v=BX.findParent(B,function(e){return BX.util.in_array(e.nodeName,n)},e.document.body)}}else{var b=e.editor.selection.GetCommonAncestorForRange(p);if(b&&b.nodeName!=="BODY"&&BX.util.in_array(b.nodeName,n)){v=b}}if(v&&!e.actions.quote.checkNode(v)){e.editor.selection.ExecuteAndRestoreSimple(function(){u(v,o,d,f)});return true}}v=BX.create(o||t,{},e.document);if(d){v.className=d}e.editor.util.SetCss(v,f);if(p.collapsed||B&&B.nodeType==3){e.editor.selection.SelectNode(B)}else if(p.collapsed){e.editor.selection.SelectLine()}e.editor.selection.Surround(v,p);l(v);s(v);if(c.leaveChilds){return v}if(o&&!BX.util.in_array(o,r)){p=e.editor.selection.GetRange();N=p.getNodes([1]);if(o=="P"){m=v.getElementsByTagName(o);for(h=0;h<N.length;h++){if(f&&e.editor.util.CheckCss(N[h],f,false)&&e.editor.util.IsEmptyNode(N[h],true,true)){BX.remove(N[h])}}while(m[0]){a(m[0]);e.editor.util.ReplaceWithOwnChildren(m[0])}}else if(o.substr(0,1)=="H"){for(h=0;h<N.length;h++){if(N[h].nodeName!==o&&e.editor.util.IsEmptyNode(N[h],true,true)){BX.remove(N[h])}}var C=BX.findChild(v,function(e){return BX.util.in_array(e.nodeName,n)&&e.nodeName.substr(0,1)=="H"},true,true);for(h=0;h<C.length;h++){a(C[h]);e.editor.util.ReplaceWithOwnChildren(C[h])}}}if(v&&c.bxTagParams&&typeof c.bxTagParams=="object"){e.editor.SetBxTag(v,c.bxTagParams)}if(v&&v.parentNode){var x=v.parentNode;if(x.nodeName=="UL"||x.nodeName=="OL"){var I=e.editor.util.GetPreviousNotEmptySibling(v);if(e.editor.util.IsEmptyLi(I)){BX.remove(I)}I=e.editor.util.GetNextNotEmptySibling(v);if(e.editor.util.IsEmptyLi(I)){BX.remove(I)}if(!e.editor.util.GetPreviousNotEmptySibling(v)&&!e.editor.util.GetNextNotEmptySibling(v)){var S=v.cloneNode(false);x.parentNode.insertBefore(S,x);e.editor.util.ReplaceWithOwnChildren(v);S.appendChild(x)}}if(v.firstChild&&v.firstChild.nodeName=="BLOCKQUOTE"){var y=e.editor.util.GetPreviousNotEmptySibling(v);if(y&&y.nodeName=="BLOCKQUOTE"&&e.editor.util.IsEmptyNode(y)){BX.remove(y)}}if((v.nodeName=="BLOCKQUOTE"||v.nodeName=="PRE")&&e.editor.util.IsEmptyNode(v)){v.innerHTML="";var T=e.document.createElement("br");v.appendChild(T);e.editor.selection.SetAfter(T)}}setTimeout(function(){if(v){e.editor.selection.SelectNode(v)}},10);return true}},state:function(t,n,r,i){n=typeof n==="string"?n.toUpperCase():n;var o=false,a=e.editor.selection.GetSelectedNode();if(a&&a.nodeName){if(a.nodeName!=n){a=BX.findParent(a,function(e){return e.nodeName==n},e.document.body)}o=a&&a.tagName==n?a:false}else{var l=e.editor.selection.GetRange(),s=e.editor.selection.GetCommonAncestorForRange(l);if(s.nodeName==n){o=s}}return o},value:BX.DoNothing,removeBrBeforeAndAfter:l,addBrBeforeAndAfter:a}},GetRemoveFormat:function(){var e={B:1,STRONG:1,I:1,EM:1,U:1,DEL:1,S:1,STRIKE:1,A:1,SPAN:1,CODE:1,NOBR:1,Q:1,FONT:1,CENTER:1,CITE:1},t={H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,DIV:1,P:1,LI:1,UL:1,OL:1,MENU:1,BLOCKQUOTE:1,PRE:1},n=this;function r(r){var i=r.nodeName;if(e[i]){n.editor.util.ReplaceWithOwnChildren(r)}else if(t[i]){n.actions.formatBlock.addBrBeforeAndAfter(r);n.editor.util.ReplaceWithOwnChildren(r)}else{r.removeAttribute("style");r.removeAttribute("class");r.removeAttribute("align");if(n.editor.bbCode&&r.nodeName=="TABLE"){r.removeAttribute("align")}}}function i(e){return BX.findParent(e,function(e){return e.nodeName=="TABLE"},n.editor.GetIframeDoc().body)}function o(e){var t,r,i=e.parentNode;while(i&&i.nodeName!=="BODY"){t=i.previousSibling&&!n.editor.util.IsEmptyNode(i.previousSibling);r=i.nextSibling&&!n.editor.util.IsEmptyNode(i.nextSibling);if(t||r||i.parentNode.nodeName=="BODY"){break}i=i.parentNode}return i}function a(e){var t=n.editor.GetIframeDoc(),r=BX.findParent(e,function(e){return e.nodeName=="UL"||e.nodeName=="OL"||e.nodeName=="MENU"},t.body);if(r){var i,o,a=r.cloneNode(false),l=r.cloneNode(false),s=true;BX.cleanNode(a);BX.cleanNode(l);for(i=0;i<r.childNodes.length;i++){o=r.childNodes[i];if(o==e){s=false}if(o.nodeName=="LI"){if(!n.editor.util.IsEmptyNode(o,true,true)){(s?a:l).appendChild(o.cloneNode(true))}}}if(a.childNodes.length>0){r.parentNode.insertBefore(a,r)}r.parentNode.insertBefore(e,r);if(l.childNodes.length>0){r.parentNode.insertBefore(l,r)}BX.remove(r);return true}return false}function l(e){if(e&&e.length>0){var t,i,o=[];for(t=0,i=e.length;t<i;t++){if(!n.editor.util.CheckSurrogateNode(e[t])){o.push({node:e[t],nesting:n.editor.util.GetNodeDomOffset(e[t])})}}o=o.sort(function(e,t){return t.nesting-e.nesting});for(t=0,i=o.length;t<i;t++){r(o[t].node)}}}function s(e){var t,r=false,i=n.editor.selection.SelectNode(e),o=i.getNodes([1]);if(e.nodeType==1){for(t=0;t<o.length;t++){if(o[t]==e){r=true;break}}if(!r){o=[e].concat(o)}}if(!o||typeof o!="object"||o.length==0){o=[e]}return o}return{exec:function(e,t){var r=n.editor.selection.GetRange();if(r&&!n.editor.iframeView.IsEmpty()){var d=true,f,c,u,m,h,g=r.getNodes([1]),N=n.editor.GetIframeDoc();if(g.length==0){c=r.getNodes([3]);if(c&&c.length==1){u=c[0]}if(!u&&r.startContainer==r.endContainer){if(r.startContainer.nodeType==3){u=r.startContainer}else{d=false;g=s(r.startContainer)}}if(u&&g.length==0){m=o(u);if(m&&(m.nodeName!="BODY"||r.collapsed)){d=false;g=s(m)}}}else{var p=false,v=[],B=i(r.startContainer),b=i(r.endContainer);if(B){v.push({startContainer:r.startContainer,startOffset:r.startOffset,end:B});r.setStartAfter(B);p=true}if(b){p=true;v.push({start:b,endContainer:r.endContainer,endOffset:r.endOffset});r.setEndBefore(b)}if(p){n.editor.selection.SetSelection(r);g=r.getNodes([1])}}if(d){h=N.createElement("span");n.editor.selection.Surround(h,r);g=s(h)}if(g&&g.length>0){n.editor.selection.ExecuteAndRestoreSimple(function(){l(g)})}if(v&&v.length>0){var C=r.cloneRange();for(f=0;f<v.length;f++){if(v[f].start){C.setStartBefore(v[f].start)}else{C.setStart(v[f].startContainer,v[f].startOffset)}if(v[f].end){C.setEndAfter(v[f].end)}else{C.setEnd(v[f].endContainer,v[f].endOffset)}n.editor.selection.SetSelection(C);l(C.getNodes([1]))}n.editor.selection.SetSelection(r)}if(d&&h&&h.parentNode){if(a(h)){n.editor.selection.SelectNode(h)}n.editor.selection.ExecuteAndRestoreSimple(function(){n.editor.util.ReplaceWithOwnChildren(h)})}}},state:BX.DoNothing,value:BX.DoNothing}},GetBold:function(){var e=this;return{exec:function(t,n){if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){return e.actions.formatInline.exec(t,n,"b")}else{return e.actions.formatBbCode.exec(t,{tag:"B"})}},state:function(t,n){return e.actions.formatInline.state(t,n,"b")},value:BX.DoNothing}},GetItalic:function(){var e=this;return{exec:function(t,n){if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){return e.actions.formatInline.exec(t,n,"i")}else{return e.actions.formatBbCode.exec(t,{tag:"I"})}},state:function(t,n){return e.actions.formatInline.state(t,n,"i")},value:BX.DoNothing}},GetUnderline:function(){var e=this;return{exec:function(t,n){if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){return e.actions.formatInline.exec(t,n,"u")}else{return e.actions.formatBbCode.exec(t,{tag:"U"})}},state:function(t,n){return e.actions.formatInline.state(t,n,"u")},value:BX.DoNothing}},GetStrikeout:function(){var e=this;return{exec:function(t,n){if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){return e.actions.formatInline.exec(t,n,"del")}else{return e.actions.formatBbCode.exec(t,{tag:"S"})}},state:function(t,n){return e.actions.formatInline.state(t,n,"del")},value:BX.DoNothing}},GetFontSize:function(){var e=this;return{exec:function(t,n){var r;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){if(n>0)r=e.actions.formatInline.exec(t,n,"span",{fontSize:n+"pt"});else r=e.actions.formatInline.exec(t,n,"span",{fontSize:null},null,{bClear:true})}else{r=e.actions.formatBbCode.exec(t,{tag:"SIZE",value:n+"pt"})}return r},state:function(t,n){return e.actions.formatInline.state(t,n,"span",{fontSize:n+"pt"})},value:BX.DoNothing}},GetForeColor:function(){var e=this;function t(){var t=e.editor.GetIframeDoc(),n,r,i=[],o=e.editor.selection.GetRange();if(o){var a=o.getNodes([1]);if(a.length==0&&o.startContainer==o.endContainer&&o.startContainer.nodeName!="BODY"){a=[o.startContainer]}for(n=0;n<a.length;n++){r=BX.findParent(a[n],function(e){return e.nodeName=="LI"&&e.style&&e.style.color},t.body);if(r){i.push(r)}}}return i.length===0?false:i}function n(t){var n=e.editor.GetIframeDoc(),r=e.editor.selection.GetSelectedNode(),i,o,a,l,s,d,f;if(r&&(r.nodeType===3||r.nodeName=="SPAN")){s=r.nodeName=="SPAN"?r:BX.findParent(r,{tag:"span"},n.body);if(s&&s.style.color){d=BX.findParent(s,{tag:"li"},n.body);if(d){if(d.childNodes.length==1&&d.firstChild==s){e.editor.selection.ExecuteAndRestoreSimple(function(){d.style.color=t;s.style.color="";if(BX.util.trim(s.style.cssText)==""){e.editor.util.ReplaceWithOwnChildren(s)}})}}}}else{if(!r){l=e.editor.selection.GetRange();f=l.getNodes([1])}else{f=[r]}for(i=0;i<f.length;i++){if(f[i]&&f[i].nodeName=="LI"){f[i].style.color=t;a=BX.findChild(f[i],function(e){return e.nodeName=="SPAN"},true,true);e.editor.selection.ExecuteAndRestoreSimple(function(){for(o=0;o<a.length;o++){if(a[o]&&a[o].parentNode&&a[o].parentNode.parentNode&&a[o].parentNode.parentNode.parentNode){try{a[o].style.color="";if(BX.util.trim(a[o].style.cssText)==""){e.editor.util.ReplaceWithOwnChildren(a[o])}}catch(t){}}}})}}}}return{exec:function(t,r){var i;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){if(r==""){i=e.actions.formatInline.exec(t,r,"span",{color:null},null,{bClear:true})}else{i=e.actions.formatInline.exec(t,r,"span",{color:r});n(r)}}else if(r){i=e.actions.formatBbCode.exec(t,{tag:"COLOR",value:r})}return i},state:function(n,r){var i=e.actions.formatInline.state(n,r,"span",{color:r});if(!i){i=t()}return i},value:BX.DoNothing}},GetBackgroundColor:function(){var e=this;return{exec:function(t,n){var r;if(n==""){r=e.actions.formatInline.exec(t,n,"span",{backgroundColor:null},null,{bClear:true})}else{r=e.actions.formatInline.exec(t,n,"span",{backgroundColor:n})}return r},state:function(t,n){return e.actions.formatInline.state(t,n,"span",{backgroundColor:n})},value:BX.DoNothing}},GetCreateLink:function(){var e=["title","id","name","target","rel"],t=this;return{exec:function(n,r){if(t.editor.bbCode&&t.editor.synchro.IsFocusedOnTextarea()){t.editor.textareaView.Focus();var i="[URL="+r.href+"]"+(r.text||r.href)+"[/URL]";t.editor.textareaView.WrapWith(false,false,i)}else{t.editor.iframeView.Focus();var o,a=typeof r==="object"?r:{href:r},l,s,d=0,f,c;function u(t,n){var r;t.removeAttribute("class");t.removeAttribute("target");for(r in n){if(n.hasOwnProperty(r)&&BX.util.in_array(r,e)){if(n[r]==""||n[r]==undefined){t.removeAttribute(r)}else{t.setAttribute(r,n[r])}}}if(n.className)t.className=n.className;t.href=n.href||"";if(n.noindex){t.setAttribute("data-bx-noindex","Y")}else{t.removeAttribute("data-bx-noindex")}}c=t.actions.formatInline.state(n,r,"a");if(c){for(l=0;l<c.length;l++){s=c[l];if(s){u(s,a);f=s;d++}}if(d===1&&f&&(f.querySelector&&!f.querySelector("*"))&&a.text!=""){t.editor.util.SetTextContent(f,a.text)}o=f;if(o)t.editor.selection.SetAfter(o);setTimeout(function(){if(o)t.editor.selection.SetAfter(o)},10)}else{var m="_bx-editor-temp-"+Math.round(Math.random()*1e6),h,g,N;t.actions.formatInline.exec(n,r,"A",false,m);if(t.document.querySelectorAll){c=t.document.querySelectorAll("A."+m)}else{c=[]}for(l=0;l<c.length;l++){s=c[l];if(s){u(s,a)}}o=s;if(c.length===1){N=t.editor.util.GetTextContent(s);g=N===""||N===t.editor.INVISIBLE_SPACE;if(N!=a.text){t.editor.util.SetTextContent(s,a.text||a.href)}if(s.querySelector&&!s.querySelector("*")&&g){t.editor.util.SetTextContent(s,a.text||a.href)}}if(s){if(s.nextSibling&&s.nextSibling.nodeType==3&&t.editor.util.IsEmptyNode(s.nextSibling)){h=s.nextSibling}else{h=t.editor.util.GetInvisibleTextNode()}t.editor.util.InsertAfter(h,s);o=h}if(o)t.editor.selection.SetAfter(o);setTimeout(function(){if(o)t.editor.selection.SetAfter(o)},10)}}},state:function(e,n){return t.actions.formatInline.state(e,n,"a")},value:BX.DoNothing}},GetRemoveLink:function(){var e=this;return{exec:function(t,n){e.editor.iframeView.Focus();var r,i,o;if(n&&typeof n=="object"){o=n}else{o=e.actions.formatInline.state(t,n,"a")}if(o){e.editor.selection.ExecuteAndRestoreSimple(function(){for(r=0;r<o.length;r++){i=o[r];if(i){e.editor.util.ReplaceWithOwnChildren(o[r])}}})}},state:function(e,t){},value:BX.DoNothing}},GetInsertHTML:function(){var e=this;return{exec:function(t,n){e.editor.iframeView.Focus();if(e.IsSupportedByBrowser(t))e.document.execCommand(t,false,n);else e.editor.selection.InsertHTML(n)},state:function(){return false},value:BX.DoNothing}},GetInsertImage:function(){var e=["title","alt","width","height","align"],t=this;return{exec:function(n,r){if(r.src=="")return;if(t.editor.bbCode&&t.editor.synchro.IsFocusedOnTextarea()){t.editor.textareaView.Focus();var i="";if(r.width)i+=" WIDTH="+parseInt(r.width);if(r.height)i+=" HEIGHT="+parseInt(r.height);var o="[IMG"+i+"]"+r.src+"[/IMG]";t.editor.textareaView.WrapWith(false,false,o);return}t.editor.iframeView.Focus();var a=typeof r==="object"?r:{src:r},l=r.image||t.actions.insertImage.state(n,r),s,d;function f(n,r){var i,o;n.removeAttribute("class");n.setAttribute("data-bx-orig-src",r.src||"");for(i in r){if(r.hasOwnProperty(i)&&BX.util.in_array(i,e)){if(r[i]==""||r[i]==undefined){n.removeAttribute(i)}else{o=n.getAttribute("data-bx-app-ex-"+i);if(!o||t.editor.phpParser.AdvancedPhpGetFragmentByCode(o,true)!=r[i]){n.setAttribute(i,r[i]);if(o){n.removeAttribute("data-bx-app-ex-"+i)}}}}}if(r.className){n.className=r.className}o=n.getAttribute("data-bx-app-ex-src");if(!o||t.editor.phpParser.AdvancedPhpGetFragmentByCode(o,true)!=r.src){n.src=r.src||"";if(o){n.removeAttribute("data-bx-app-ex-src")}}}if(!l){l=t.document.createElement("IMG");f(l,a);t.editor.selection.InsertNode(l)}else{f(l,a)}var c=l,u=l.parentNode&&l.parentNode.nodeName=="A"?l.parentNode:null;if(a.link){if(u){u.href=a.link}else{u=t.document.createElement("A");u.href=a.link;l.parentNode.insertBefore(u,l);u.appendChild(l)}c=u}else if(u){t.editor.util.ReplaceWithOwnChildren(u)}if(BX.browser.IsIE()){t.editor.selection.SetAfter(l);d=l.nextSibling;if(d&&d.nodeType==3&&t.editor.util.IsEmptyNode(d))s=d;else s=t.editor.util.GetInvisibleTextNode();t.editor.selection.InsertNode(s);c=s}t.editor.selection.SetAfter(c);t.editor.util.Refresh()},state:function(){var e,n,r;if(!t.editor.util.DocumentHasTag(t.document,"IMG"))return false;e=t.editor.selection.GetSelectedNode();if(!e)return false;if(e.nodeName==="IMG")return e;if(e.nodeType!==1)return false;n=BX.util.trim(t.editor.selection.GetText());if(n&&n!=t.editor.INVISIBLE_SPACE)return false;r=t.editor.selection.GetNodes(1,function(e){return e.nodeName==="IMG"});if(r.length!==1)return false;return r[0]},value:BX.DoNothing}},GetInsertLineBreak:function(){var e=this,t="<br>"+(BX.browser.IsOpera()?" ":"");return{exec:function(n){if(e.IsSupportedByBrowser(n)){e.document.execCommand(n,false,null)}else{e.actions.insertHTML.exec("insertHTML",t)}if(BX.browser.IsChrome()||BX.browser.IsSafari()||BX.browser.IsIE10()){e.editor.selection.ScrollIntoView()}},state:BX.DoNothing,value:BX.DoNothing}},GetInsertTable:function(){var e=this,t=["title","id","border","cellSpacing","cellPadding","align"];function n(t){var n=e.document.createElement("TH");while(t.firstChild)n.appendChild(t.firstChild);e.editor.util.ReplaceNode(t,n)}function r(t){var n=e.document.createElement("TD");while(t.firstChild)n.appendChild(t.firstChild);e.editor.util.ReplaceNode(t,n)}function i(i,o){var a;i.removeAttribute("class");for(a in o){if(o.hasOwnProperty(a)&&BX.util.in_array(a,t)){if(o[a]==""||o[a]==undefined){i.removeAttribute(a)}else{i.setAttribute(a,o[a])}}}if(o.className){i.className=o.className}i.removeAttribute("data-bx-no-border");if(i.getAttribute("border")==0||!i.getAttribute("border")){i.removeAttribute("border");i.setAttribute("data-bx-no-border","Y")}if(o.width){if(parseInt(o.width)==o.width){o.width=o.width+"px"}if(i.getAttribute("width")){i.setAttribute("width",o.width)}else{i.style.width=o.width}}if(o.height){if(parseInt(o.height)==o.height){o.height=o.height+"px"}if(i.getAttribute("height")){i.setAttribute("height",o.height)}else{i.style.height=o.height}}var l,s,d;for(l=0;l<i.rows.length;l++){for(s=0;s<i.rows[l].cells.length;s++){d=i.rows[l].cells[s];if((o.headers=="top"||o.headers=="topleft")&&l==0||(o.headers=="left"||o.headers=="topleft")&&s==0){n(d)}else if(d.nodeName=="TH"){r(d)}}}var f=BX.findChild(i,{tag:"CAPTION"},false);if(o.caption){if(f){f.innerHTML=BX.util.htmlspecialchars(o.caption)}else{f=e.document.createElement("CAPTION");f.innerHTML=BX.util.htmlspecialchars(o.caption);i.insertBefore(f,i.firstChild)}}else if(f){BX.remove(f)}}return{exec:function(t,n){if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){if(!n||!n.rows||!n.cols){return false}e.editor.iframeView.Focus();var r=n.table||e.actions.insertTable.state(t,n);n.rows=parseInt(n.rows)||1;n.cols=parseInt(n.cols)||1;if(n.align=="left"||e.editor.bbCode){n.align=""}if(!r){r=e.document.createElement("TABLE");var o=r.appendChild(e.document.createElement("TBODY")),a,l,s,d;n.rows=parseInt(n.rows)||1;n.cols=parseInt(n.cols)||1;for(a=0;a<n.rows;a++){s=o.insertRow(-1);for(l=0;l<n.cols;l++){d=BX.adjust(s.insertCell(-1),{html:"&nbsp;"})}}i(r,n);e.editor.selection.InsertNode(r);var f=e.editor.util.GetNextNotEmptySibling(r);if(!f){e.editor.util.InsertAfter(BX.create("BR",{},e.document),r)}if(f&&f.nodeName=="BR"&&!f.nextSibling){e.editor.util.InsertAfter(e.editor.util.GetInvisibleTextNode(),f)}}else{i(r,n)}var c=r.rows[0].cells[0].firstChild;if(c){e.editor.selection.SetAfter(c)}setTimeout(function(){e.editor.util.Refresh(r)},10)}else{e.editor.textareaView.Focus();var u="",m,h,g=e.editor.INVISIBLE_SPACE;if(n.rows>0&&n.cols>0){u+="[TABLE]\n";for(m=0;m<n.rows;m++){u+="	[TR]\n";for(h=0;h<n.cols;h++){u+="		[TD]"+g+"[/TD]\n"}u+="	[/TR]\n"}u+="[/TABLE]\n"}e.editor.textareaView.WrapWith(false,false,u)}},state:function(t,n){var r,i;if(!e.editor.util.DocumentHasTag(e.document,"TABLE")){return false}r=e.editor.selection.GetSelectedNode();if(!r){return false}if(r.nodeName==="TABLE"){return r}if(r.nodeType!==1){return false}i=e.editor.selection.GetNodes(1,function(e){return e.nodeName==="TABLE"});if(i.length!==1){return false}return i[0]},value:BX.DoNothing}},GetInsertList:function(e){var t=this;var n=!!e.bOrdered,r=n?"OL":"UL",i=n?"UL":"OL";function o(e){var n=e.nextSibling;while(n&&n.nodeType==3&&t.editor.util.IsEmptyNode(n,true)){n=n.nextSibling}return n}function a(e){if(e.nodeName!=="MENU"&&e.nodeName!=="UL"&&e.nodeName!=="OL"){return}var n=t.document.createDocumentFragment(),r=e.previousSibling,i,o,a,l;if(r&&!t.editor.util.IsBlockElement(r)&&!t.editor.util.IsEmptyNode(r,true)){n.appendChild(t.document.createElement("BR"))}while(l=e.firstChild){o=l.lastChild;while(i=l.firstChild){a=i===o&&!t.editor.util.IsBlockElement(i)&&i.nodeName!=="BR";n.appendChild(i);if(a){n.appendChild(t.document.createElement("BR"))}}l.parentNode.removeChild(l)}var s=t.editor.util.GetNextNotEmptySibling(e);if(s&&s.nodeName=="BR"&&n.lastChild&&n.lastChild.nodeName=="BR"){BX.remove(n.lastChild)}e.parentNode.replaceChild(n,e)}function l(e,n){if(!e||!e.parentNode)return false;var r=e.nodeName.toUpperCase();if(r==="UL"||r==="OL"||r==="MENU"){return e}var i=t.document.createElement(n),o,a;while(e.firstChild){a=a||i.appendChild(t.document.createElement("li"));o=e.firstChild;if(t.editor.util.IsBlockElement(o)){a=a.firstChild?i.appendChild(t.document.createElement("li")):a;a.appendChild(o);a=null;continue}if(o.nodeName==="BR"){a=a.firstChild?null:a;e.removeChild(o);continue}a.appendChild(o)}e.parentNode.replaceChild(i,e);return i}function s(e){return e.nodeName=="OL"||e.nodeName=="UL"||e.nodeName=="MENU"}function d(e,n){if(!n){n=t.editor.selection.GetSelectedNode()}if(!n){var r=t.editor.selection.GetRange(),i=t.editor.selection.GetCommonAncestorForRange(r);if(i&&s(i)){n=i}else{var o,a=true,l,d,f=r.getNodes([1]),c=f.length;if(i){l=d=BX.findParent(i,s,t.document.body)}if(!d){for(o=0;o<c;o++){d=BX.findParent(f[o],s,i);if(!d||l&&d!=l){a=false;break}l=d}}if(l){n=l}}}return n&&n.nodeName==e?n:BX.findParent(n,{tagName:e},t.document.body)}return{exec:function(e,o){if(!t.editor.bbCode||!t.editor.synchro.IsFocusedOnTextarea()){var s=t.editor.selection.GetRange();if(t.IsSupportedByBrowser(e)&&s.collapsed){t.document.execCommand(e,false,null)}else{var f=t.editor.selection.GetSelectedNode(),c=d(r,f),u=d(i,f),m,h;if(c){t.editor.selection.ExecuteAndRestoreSimple(function(){a(c)})}else if(u){t.editor.selection.ExecuteAndRestoreSimple(function(){t.editor.util.RenameNode(u,r)})}else{h=t.document.createElement("span");t.editor.selection.Surround(h);m=h.innerHTML===""||h.innerHTML===t.editor.INVISIBLE_SPACE;t.editor.selection.ExecuteAndRestoreSimple(function(){c=l(h,r)});if(c){var g=0,N;while(g<c.childNodes.length){N=c.childNodes[g];if(N.nodeName=="LI"){if(t.editor.util.IsEmptyNode(N,true,true)){BX.remove(N);continue}g++}else if(N.nodeType==1){BX.remove(N)}}var p=t.editor.util.GetPreviousNotEmptySibling(c);if(p&&(p.nodeName=="BLOCKQUOTE"||p.nodeName=="PRE"||p.nodeName=="UL"||p.nodeName=="OL")&&c.childNodes[0]&&BX.findChild(c.childNodes[0],{tag:p.nodeName})){if(BX.util.trim(t.editor.util.GetTextContent(p))==""){BX.remove(p)}}}if(m&&c&&c.querySelector){t.editor.selection.SelectNode(c.querySelector("li"))}}}}else{if(o&&o.items){t.editor.textareaView.Focus();var v="[LIST"+(n?"=1":"")+"]\n",B;for(B=0;B<o.items.length;B++){v+="	[*]"+o.items[B]+"\n"}v+="[/LIST]\n";t.editor.textareaView.WrapWith(false,false,v)}}},state:function(e,t){return d(r)||false},value:BX.DoNothing}},GetAlign:function(){var e="bx-align-tmp",t="data-bx-checked-align-list",n="left",r={TD:1,TR:1,TH:1,TABLE:1,TBODY:1,CAPTION:1,COL:1,COLGROUP:1,TFOOT:1,THEAD:1},i={IMG:1,P:1,DIV:1,TABLE:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1},o=this;function a(e){var t=e.nodeName,n,r=false;if(e.nodeType===1){n=e.style.textAlign;if(e.style.textAlign){r={node:e,style:n}}if(i[t]){n=e.getAttribute("align");if(n){if(r){r.attribute=n}else{r={node:e,attribute:n}}}}}return r}function l(e){return e&&(e.nodeName=="TD"||e.nodeName=="TH")}function s(e,t){e.setAttribute("data-bx-tmp-align",t);e.style.textAlign=t}function d(e,t){if(t=="left"||t=="justify"||o.editor.bbCode){e.removeAttribute("align")}else{e.setAttribute("align",t)}}function f(e,t){var n,r,i=true,o=e.getElementsByTagName("TD");for(r=0;r<o.length;r++){if(o[r].getAttribute("data-bx-tmp-align")!=t){i=false;break}}if(i){n=e.getElementsByTagName("TH");for(r=0;r<n.length;r++){if(n[r].getAttribute("data-bx-tmp-align")!=t){i=false;break}}}if(i){d(e,t)}}function c(e,t){var n=BX.create("DIV",{style:{textAlign:t},html:e.innerHTML},o.editor.GetIframeDoc());e.innerHTML="";e.appendChild(n);return n}function u(e,t){var n=BX.create("DIV",{style:{textAlign:t}},o.editor.GetIframeDoc());e.parentNode.insertBefore(n,e);n.appendChild(e);return n}function m(e,n,r){var i=o.editor.GetIframeDoc(),a=o.editor.bbCode;if(!e&&n){e=BX.findParent(n,function(e){return e.nodeName=="OL"||e.nodeName=="UL"||e.nodeName=="MENU"},i)}if(e&&!e.getAttribute(t)){var l,s=true,d=e.getElementsByTagName("LI");for(l=0;l<d.length;l++){if(d[l].style.textAlign!==r){s=false;break}}if(a){e.style.textAlign="";if(e.style.cssText==""){e.removeAttribute("style")}h(e);u(e,r)}else if(s){e.style.textAlign=r;h(e)}e.setAttribute(t,"Y");return e}return false}function h(e){var t,n=e.getElementsByTagName("LI");for(t=0;t<n.length;t++){n[t].style.textAlign="";if(n[t].style.cssText==""){n[t].removeAttribute("style")}}}function g(e,t){if(t&&t.nodeName=="TABLE"){var n,r=false;for(n=0;n<e.length;n++){if(e[n]==t){r=true;break}}if(!r){e.push(t)}}return e}return{exec:function(n,i){var a;if(!o.editor.bbCode||!o.editor.synchro.IsFocusedOnTextarea()){var N,p="P",v=o.editor.selection.GetRange(),B=false,b=false,C=false,x=o.editor.selection.GetBookmark(),I=o.editor.selection.GetSelectedNode();if(I){if(o.editor.util.IsBlockNode(I)){B=I}else if(I.nodeType==1&&r[I.nodeName]){b=I;a=true;setTimeout(function(){o.editor.selection.SelectNode(b);if(b.nodeName=="TABLE"){d(b,i)}},10)}else{if(I.nodeName=="LI"){C=I}else if(I.nodeName=="OL"||I.nodeName=="UL"||I.nodeName=="MENU"){if(o.editor.bbCode){u(I,i);I.style.textAlign=""}else{I.style.textAlign=i}a=true;h(I);setTimeout(function(){o.editor.selection.SelectNode(I)},10)}else{C=BX.findParent(I,function(e){return e.nodeName=="LI"},o.document.body)}if(C){if(o.editor.bbCode){c(C,i);C.style.textAlign=""}else{C.style.textAlign=i}a=true;setTimeout(function(){o.editor.selection.SelectNode(C)},10)}else{B=BX.findParent(I,function(e){return o.editor.util.IsBlockNode(e)&&!o.actions.quote.checkNode(e)},o.document.body)}}}else{var S=[],y=false,T=[],A=[],G=v.getNodes([1]);for(N=0;N<G.length;N++){if(l(G[N])){S=g(S,BX.findParent(G[N],{tagName:"TABLE"}));s(G[N],i);a=true}if(G[N].nodeName=="TABLE"){S=g(S,G[N]);y=true}else if(G[N].nodeName=="OL"||G[N].nodeName=="UL"||G[N].nodeName=="MENU"){G[N].style.textAlign=i;T.push(G[N]);a=true}else if(G[N].nodeName=="LI"){G[N].style.textAlign=i;a=true;A.push(G[N])}}for(N=0;N<S.length;N++){f(S[N],i)}if(a){var w=o.editor.selection.GetCommonAncestorForRange(v);if(w&&w.nodeName=="BODY"){a=false}}for(N=0;N<T.length;N++){h(T[N])}var E=[],X;for(N=0;N<A.length;N++){X=m(false,A[N],i);if(X){E.push(X)}}for(N=0;N<E.length;N++){E[N].removeAttribute(t)}}if(!a){if(B){if(o.editor.bbCode){
c(B,i);B.style.textAlign=""}else{p=B.tagName!="DIV"?B.tagName:"P";a=o.actions.formatBlock.exec("formatBlock",p,null,{textAlign:i})}o.editor.util.Refresh(B)}else if(b){if(l(b)){s(b,i)}else{var R=BX.findChild(b,l,true,true),L=BX.findChild(b,l,true,true);for(N=0;N<R.length;N++){s(R[N],i)}for(N=0;N<L.length;N++){s(L[N],i)}}}else if(v.collapsed){a=o.actions.formatBlock.exec("formatBlock","P",e,{textAlign:i});var O,k=o.document.querySelectorAll("."+e);for(N=0;N<=k.length;N++){BX.removeClass(k[N],e);if(N==0){O=k[N].firstNode;if(!O)O=k[N].appendChild(o.editor.util.GetInvisibleTextNode());setTimeout(function(){if(O)o.editor.selection.SetAfter(O)},100)}}}else{var D=o.actions.insertImage.state();if(!a&&false){var F=true;G=v.getNodes([1]);if(G&&G.length>0){for(N=0;N<G.length;N++){if(G[N].nodeName=="P"){G[N].style.textAlign=i}else{F=false}}a=F}}if(!a){p=o.editor.bbCode?"DIV":"P";a=o.actions.formatBlock.exec("formatBlock",p,null,{textAlign:i},{leaveChilds:true});if(a&&typeof a=="object"&&a.nodeName==p){var P=0,M=2e3,H,U,V,W=false;if(a.firstChild&&a.firstChild.nodeName=="BLOCKQUOTE"){H=o.editor.util.GetPreviousNotEmptySibling(a);if(H&&H.nodeName=="BLOCKQUOTE"&&o.editor.util.IsEmptyNode(H)){BX.remove(H)}}N=0;while(N<a.childNodes.length||P>M){U=a.childNodes[N];if(o.editor.util.IsBlockNode(U)){U.style.textAlign=i;W=true;N++}else{if(!V||W){V=o.document.createElement(p);V.style.textAlign=i;a.insertBefore(V,U);N++}V.appendChild(U);W=false}P++}if(a.previousSibling&&a.previousSibling.nodeName=="P"&&o.editor.util.IsEmptyNode(a.previousSibling,true,true)){BX.remove(a.previousSibling)}if(a.nextSibling&&a.nextSibling.nodeName=="P"&&o.editor.util.IsEmptyNode(a.nextSibling,true,true)){BX.remove(a.nextSibling)}o.editor.util.ReplaceWithOwnChildren(a);setTimeout(function(){if(V)o.editor.selection.SelectNode(V)},100)}}if(D){o.editor.util.Refresh(D)}}}setTimeout(function(){o.editor.selection.SetBookmark(x)},10)}else{if(i){a=o.actions.formatBbCode.exec(n,{tag:i.toUpperCase()})}}return a},state:function(e,t){var r,i,l=o.editor.selection.GetSelectedNode();if(l){r=a(l);if(!r){i=BX.findParent(l,function(e){r=a(e);return r},o.document.body)}return{node:r?r.node:null,value:r?r.style||r.attribute:n,res:r}}else{var s={node:null,value:n,res:true},d=o.editor.selection.GetRange();if(!d.collapsed){var f,c="",u,m=d.getNodes([1]);for(u=0;u<m.length;u++){if(!o.editor.util.CheckSurrogateNode(m[u])&&m[u].nodeName!=="BR"&&o.editor.util.GetNodeDomOffset(m[u])==0){f=a(m[u]);t=f?f.style||f.attribute:n;if(!c){c=t}if(t!=c){s.res=false;break}}}if(s.res){s.value=c}}else{s.res=false}return s}},value:BX.DoNothing}},GetIndent:function(){var e=this;return{exec:function(t){var n=e.editor.selection.GetRange();if(n&&n.collapsed&&n.endContainer==n.startContainer&&BX.util.in_array(n.startContainer.nodeName,["TD","TR","TH"])&&arguments[1]!==n.startContainer.nodeName){var r="bxed_bogus_node_59811",i=n.startContainer.appendChild(BX.create("SPAN",{props:{id:r},html:"&nbsp;"},e.document));is_text=e.editor.util.GetInvisibleTextNode();if(i){n.setStartBefore(i);n.setEndAfter(i);e.editor.selection.SetSelection(n);return setTimeout(function(){e.actions.indent.exec(t,n.startContainer.nodeName);var i=e.editor.GetIframeElement(r);if(i){e.editor.selection.SetAfter(i);BX.remove(i)}},0)}}if(e.IsSupportedByBrowser(t)){e.document.execCommand(t)}else{e.actions.formatBlock.exec("formatBlock","BLOCKQUOTE")}var o=e.editor.selection.GetRange();if(o){var a,l=o.getNodes([1]);if(o.collapsed&&o.startContainer&&l.length==0){var s=BX.findParent(o.startContainer,{tag:"BLOCKQUOTE"});s.removeAttribute("style");var d=e.editor.util.GetInvisibleTextNode();s.appendChild(d);e.editor.selection.SetAfter(d)}for(a=0;a<l.length;a++){if(l[a].nodeName=="BLOCKQUOTE"){l[a].removeAttribute("style")}}}},state:function(t,n){var r=false,i=e.editor.selection.GetRange();if(i){var o=e.editor.selection.GetCommonAncestorForRange(i);if(o&&o.nodeType==1&&o.nodeName==="BLOCKQUOTE"){r=o}}return r},value:BX.DoNothing}},GetOutdent:function(){var e=this;return{exec:function(t,n){var r,i="data-bx-tmp-flag",o=e.editor.GetIframeDoc(),a=o.getElementsByTagName("BLOCKQUOTE");{var l=[],s=o.getElementsByTagName("P");for(r=0;r<s.length;r++){s[r].setAttribute(i,"Y")}e.document.execCommand(t);s=o.getElementsByTagName("P");for(r=0;r<s.length;r++){if(!s[r].getAttribute(i)){l.push(s[r])}else{s[r].removeAttribute(i)}}e.editor.selection.ExecuteAndRestoreSimple(function(){for(r=0;r<l.length;r++){e.actions.formatBlock.addBrBeforeAndAfter(l[r]);e.editor.util.ReplaceWithOwnChildren(l[r])}})}},state:function(t,n){var r=e.editor.selection.GetRange();return false},value:BX.DoNothing}},GetFontFamily:function(){var e=this;return{exec:function(t,n){var r;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){if(n)r=e.actions.formatInline.exec(t,n,"span",{fontFamily:n});else r=e.actions.formatInline.exec(t,n,"span",{fontFamily:null},null,{bClear:true})}else{return e.actions.formatBbCode.exec(t,{tag:"FONT",value:n})}return r},state:function(t,n){return e.actions.formatInline.state(t,n,"span",{fontFamily:n})},value:BX.DoNothing}},GetFormatStyle:function(){var e=this,t=e.editor.GetBlockTags();function n(n){if(n&&n.nodeType==1&&n.nodeName!=="BODY"&&BX.util.in_array(n.nodeName,t)){return!e.editor.GetBxTag(n.id).tag}return false}return{exec:function(t,n){if(!n){return e.actions.formatBlock.exec("formatBlock",null)}else if(typeof n==="string"){return e.actions.formatBlock.exec("formatBlock",n)}else if(typeof n==="object"){}},state:function(t,r){var i=false,o=e.editor.selection.GetSelectedNode();if(o){if(n(o)){i=o}else{i=BX.findParent(o,n,e.document.body)}}else{var a=e.editor.selection.GetRange(),l=e.editor.selection.GetCommonAncestorForRange(a);if(n(l)){i=l}}return i},value:BX.DoNothing}},GetChangeTemplate:function(){var e=this;return{exec:function(t,n){e.editor.ApplyTemplate(n)},state:function(t,n){return e.editor.GetTemplateId()},value:BX.DoNothing}},GetSelectNode:function(){var e=this;return{exec:function(t,n){if(!e.editor.iframeView.IsFocused()){e.editor.iframeView.Focus()}if(n===false||n&&n.nodeName=="BODY"){if(e.IsSupportedByBrowser("SelectAll")){e.document.execCommand("SelectAll")}else{e.editor.selection.SelectNode(n)}}else{e.editor.selection.SelectNode(n)}},state:BX.DoNothing,value:BX.DoNothing}},GetUndoRedo:function(e){var t=this;return{exec:function(e){if(e=="doUndo"){t.editor.undoManager.Undo()}else if(e=="doRedo"){t.editor.undoManager.Redo()}},state:BX.DoNothing,value:BX.DoNothing}},GetUniversalFormatStyle:function(){var e="bx-tmp-ufs-class",t="data-bx-tmp-status",n=this;function r(r){var o=[];if(r&&r.length>0){var a,l,s=[],d,f;for(a=0,l=r.length;a<l;a++){if(!n.editor.util.CheckSurrogateNode(r[a])&&r[a].nodeName!=="BR"){r[a].setAttribute(t,"Y");s.push({node:r[a],nesting:n.editor.util.GetNodeDomOffset(r[a])})}}s=s.sort(function(e,t){return e.nesting-t.nesting});for(a=0,l=s.length;a<l;a++){d=s[a].node;f=d.getAttribute(t);if(f=="Y"&&!i(d)){BX.findChild(d,function(n){if(n.nodeType==1&&n.nodeName!=="BR"&&n.setAttribute){n.setAttribute(t,n.className==e?"GET_RID_OF":"SKIP")}return false},true,true);o.push(d)}}}return o}function i(e){var n=BX.findChild(e,function(e){return e.nodeType==1&&e.nodeName!=="BR"&&e.getAttribute&&e.getAttribute(t)!=="Y"},true,false);return!!n}function o(e,t,n){try{if(t!==false){if(t==""){e.removeAttribute("class")}else{e.className=t}}if(n!==false){if(n==""){e.removeAttribute("style")}else{e.style.cssText=n}}}catch(r){}}return{exec:function(i,a){if(a.nodes&&a.nodes.length>0){for(s=0;s<a.nodes.length;s++){o(a.nodes[s],a.className,a.style)}}else{n.actions.formatInline.exec(i,a,"span",false,e);if(document.querySelectorAll){var l=n.editor.GetIframeDoc().querySelectorAll("."+e);if(l){for(s=0;s<l.length;s++){d=l[s];if(BX.util.trim(d.innerHTML)==""){n.editor.util.ReplaceWithOwnChildren(d)}}}}var s,d,f=n.actions.universalFormatStyle.state(i),c=r(f);for(s=0;s<c.length;s++){o(c[s],a.className,a.style)}if(document.querySelectorAll){l=n.editor.GetIframeDoc().querySelectorAll("."+e);if(l){for(s=0;s<l.length;s++){d=l[s];if(d.getAttribute(t)=="GET_RID_OF"){n.editor.util.ReplaceWithOwnChildren(l[s])}else{o(l[s],a.className,a.style)}}}}}},state:function(e){var t=n.editor.selection.GetRange();if(t){var r,i,o,a=t.getNodes([1]);if(a.length==0){r=t.getNodes([3]);if(r&&r.length==1){i=r[0]}if(!i&&t.startContainer==t.endContainer){if(t.startContainer.nodeType==3){i=t.startContainer}else{n.editor.selection.SelectNode(t.startContainer);a=[t.startContainer]}}if(i&&a.length==0){o=i.parentNode;if(o){a=[o]}}}return a}},value:BX.DoNothing}},GetSubSup:function(e){var t=this;e=e=="sup"?"sup":"sub";return{exec:function(n,r){return t.actions.formatInline.exec(n,r,e)},state:function(n,r){return t.actions.formatInline.state(n,r,e)},value:BX.DoNothing}},GetQuote:function(){var e,t,n=this;function r(e){return e&&e.className=="bxhtmled-quote"&&e.nodeName=="BLOCKQUOTE"}function i(e){t=e}function o(){return t}function a(t){return e=t}return{exec:function(t){var r=false,i=o();if(n.editor.bbCode&&n.editor.synchro.IsFocusedOnTextarea()){n.editor.textareaView.Focus();if(i){r=n.editor.textareaView.WrapWith(false,false,"[QUOTE]"+i+"[/QUOTE]")}else{r=n.actions.formatBbCode.exec(t,{tag:"QUOTE"})}}else{if(i){if(!e&&n.editor.selection.lastCheckedRange&&n.editor.selection.lastCheckedRange.range){e=n.editor.selection.lastCheckedRange.range}n.editor.iframeView.Focus();if(e){n.editor.selection.SetSelection(e)}var a="bxq_"+Math.round(Math.random()*1e6);n.editor.InsertHtml('<blockquote id="'+a+'" class="bxhtmled-quote">'+i+"</blockquote>"+n.editor.INVISIBLE_SPACE,e);setTimeout(function(){var e=n.editor.GetIframeElement(a);if(e){var t=e.previousSibling;if(t&&t.nodeType==3&&n.editor.util.IsEmptyNode(t)&&t.previousSibling&&t.previousSibling.nodeName=="BR"){BX.remove(t)}e.id=null}},0)}else{r=n.actions.formatBlock.exec("formatBlock","blockquote","bxhtmled-quote",false,{range:e})}}e=null;return r},state:function(){return n.actions.formatBlock.state("formatBlock","blockquote","bxhtmled-quote")},value:BX.DoNothing,setExternalSelection:i,getExternalSelection:o,setRange:a,checkNode:r}},GetCode:function(){var e=this;return{exec:function(t){if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){var n=e.actions.code.state();if(n){var r=BX.util.trim(n.innerHTML);if(r=="<br>"||r===""){e.editor.selection.SetAfter(n);BX.remove(n)}else{e.editor.selection.ExecuteAndRestoreSimple(function(){n.className="";n=e.editor.util.RenameNode(n,"P")})}}else{e.actions.formatBlock.exec("formatBlock","pre","bxhtmled-code")}}else{return e.actions.formatBbCode.exec(t,{tag:"CODE"})}},state:function(){return e.actions.formatBlock.state("formatBlock","pre","bxhtmled-code")},value:BX.DoNothing}},GetInsertSmile:function(){var e=this;return{exec:function(t,n){var r=e.editor.smilesIndex[n];if(e.editor.bbCode&&e.editor.synchro.IsFocusedOnTextarea()){e.editor.textareaView.Focus();e.editor.textareaView.WrapWith(false,false,r.code)}else{e.editor.iframeView.Focus();if(r){var i=BX.create("IMG",{props:{src:r.path,title:r.name||r.code}});e.editor.SetBxTag(i,{tag:"smile",params:r});e.editor.selection.InsertNode(i);e.editor.selection.SetAfter(i);setTimeout(function(){e.editor.selection.SetAfter(i)},10)}}},state:BX.DoNothing,value:BX.DoNothing}},GetTableOperation:function(){var e=this,t="&nbsp;";function n(e){var t=e.rows;var n=[],r,i,o,a,l,s,d,f,c=-1;for(r=0;r<t.length;r++){c++;if(!n[c]){n[c]=[]}i=-1;for(o=0;o<t[r].cells.length;o++){a=t[r].cells[o];i++;while(n[c][i]){i++}d=isNaN(a.colSpan)?1:a.colSpan;f=isNaN(a.rowSpan)?1:a.rowSpan;for(l=0;l<f;l++){if(!n[c+l]){n[c+l]=[]}for(s=0;s<d;s++){n[c+l][i+s]=t[r].cells[o]}}i+=d-1}}return n}function r(e,t){var n,r,i=[];for(n=0;n<t.length;n++){for(r=0,l=t[n].length;r<l;r++){if(t[n][r]==e){i.push({r:n,c:r})}}}return i}function i(e){var t=[],n=[],r={cells:0},i;for(i=0;i<e.length;i++){r.cells++;r.maxRow=i===0?e[i].r:Math.max(e[i].r,r.maxRow);r.minRow=i===0?e[i].r:Math.min(e[i].r,r.minRow);r.maxCol=i===0?e[i].c:Math.max(e[i].c,r.maxCol);r.minCol=i===0?e[i].c:Math.min(e[i].c,r.minCol);if(!BX.util.in_array(e[i].r,t))t.push(e[i].r);if(!BX.util.in_array(e[i].c,n))n.push(e[i].c)}r.rows=t.length;r.cols=n.length;return r}function o(e,t,n){if(t){t=c(t,n);if(t&&!BX.util.in_array(t,e))e.push(t)}return e}function a(t,n){var r=[],i;if(BX.browser.IsFirefox()){var a,l,s,d,f=rangy.getNativeSelection(e.editor.sandbox.GetWindow());for(a=0;a<f.rangeCount;a++){l=f.getRangeAt(a);s=l.startContainer.nodeType===1?l.startContainer.childNodes[l.startOffset]:l.startContainer;d=l.endContainer.nodeType===1?l.endContainer.childNodes[l.endOffset]:l.endContainer;r=o(r,s,n);r=o(r,d,n)}}else{if(t.collapsed){i=c(t.startContainer);r=o(r,i,n)}else{var u=t.getNodes([1]);for(a=0;a<u.length;a++){if(u[a].nodeName=="TD"||u[a].nodeName=="TH"){r=o(r,u[a],n)}}}}return r}function s(e,i,o){var a=BX.findParent(e,{tag:"TD"});if(!a)return;var l=a.parentNode,s=o=="insertColumnLeft"?a.cellIndex:a.cellIndex+1,d=l.rowIndex,f=n(i),c=r(a,f);l.insertCell(s).innerHTML=t;var u,m,h,g,N,p=o=="insertColumnLeft"?c[0].c:c[0].c+1;for(N=0;N<i.rows.length;N++){u=i.rows[N];if(u.rowIndex==d){continue}m=0;h=0;for(h=0;h<u.cells.length;h++){g=u.cells[h];c=r(g,f);if(c[0].c>=p){m=g.cellIndex;break}m=h+1}u.insertCell(m).innerHTML="&nbsp;"}}function d(e,n,r){var i=BX.findParent(e,{tag:"TR"});if(!i||!n)return;var o,a,l=r=="insertRowUpper"?i.rowIndex:i.rowIndex+1,s=n.insertRow(l);for(o=0;o<i.cells.length;o++){a=s.insertCell(o);a.innerHTML=t;a.colSpan=i.cells[o].colSpan}}function f(e,n,r){var i=c(e,n);if(!i||!n)return;var o=i.parentNode,a=r=="insertCellLeft"?i.cellIndex:i.cellIndex+1;o.insertCell(a).innerHTML=t}function c(e,t){if(e.nodeName=="TD"||e.nodeName=="TH")return e;return BX.findParent(e,function(e){return e.nodeName=="TD"||e.nodeName=="TH"},t)}function u(e,t){var o,a,l=n(t),s=i(r(e[0],l)),d=s,f=false,c=true,u=true;for(a=1;a<e.length;a++){o=i(r(e[a],l));c=c&&o.rows==s.rows&&o.maxRow==s.maxRow&&o.minRow==s.minRow;u=u&&o.cols==s.cols&&o.maxCol==s.maxCol&&o.minCol==s.minCol;f=f||c&&Math.abs(o.minCol-d.maxCol)>1||u&&Math.abs(o.minRow-d.maxRow)>1||!c&&!u;d=o}return{sameCol:u,sameRow:c,gaps:f}}function m(e,t,n){if(!e)e=a(t,n);if(!e||e.length<2)return false;var r=u(e,n);return!r.gaps&&(!r.sameRow&&r.sameCol||r.sameRow&&!r.sameCol)}function h(e,t){var i=a(e,t);if(!i||i.length!==1)return false;var o=n(t),l=r(i[0],o);if(l.length<1)return false;var s,d,f=l[l.length-1].c,c=true,u;for(s=0;s<l.length;s++){if(l[s].c==f){if(o[l[s].r]&&o[l[s].r][l[s].c+1]){u=o[l[s].r][l[s].c+1];if(d===undefined)d=u;else if(d!==u)c=false}else{c=false}}}c=c&&d&&m([i[0],d],e,t);return c}function g(e,t){var i=a(e,t);if(!i||i.length!==1)return false;var o=n(t),l=r(i[0],o);if(l.length<1)return false;var s,d,f=l[l.length-1].r,c=true,u;for(s=0;s<l.length;s++){if(l[s].r==f){if(o[f+1]&&o[f+1][l[s].c]){u=o[f+1][l[s].c];if(d===undefined)d=u;else if(d!==u)c=false}else{c=false}}}c=c&&d&&m([i[0],d],e,t);return c}function N(e,t,n){if(!n)n=a(e,t);if(n.length<2)return;var r=u(n,t),i,o,l=0,s=0,d="";if(r.sameRow&&!r.sameCol&&!r.gaps){for(i=0;i<n.length;i++){d+=" "+BX.util.trim(n[i].innerHTML);o=n[i].parentNode;l+=n[i].colSpan;if(i>0)o.removeChild(n[i])}n[0].colSpan=l;n[0].innerHTML=BX.util.trim(d)}else if(!r.sameRow&&r.sameCol&&!r.gaps){for(i=0;i<n.length;i++){d+=" "+BX.util.trim(n[i].innerHTML);o=n[i].parentNode;s+=n[i].rowSpan;if(i>0)o.removeChild(n[i])}n[0].rowSpan=s;n[0].innerHTML=BX.util.trim(d)}else{alert(BX.message("BXEdTableMergeError"))}}function p(e,t){var n=a(e,t);if(!n||n.length!==1)return false;var r=BX.findParent(n[0],{tag:"TR"},t);if(n[0].cellIndex<r.cells.length-1){n.push(r.cells[n[0].cellIndex+1])}return N(e,t,n)}function v(e,t){var i=a(e,t);if(!i||i.length!==1)return false;var o=n(t),l=r(i[0],o),s,d,f=l[l.length-1].r,c=true,u;for(s=0;s<l.length;s++){if(l[s].r==f){if(o[f+1]&&o[f+1][l[s].c]){u=o[f+1][l[s].c];if(d===undefined)d=u;else if(d!==u)c=false}else{c=false}}}if(c){i.push(d);return N(e,t,i)}}function B(e,t){var n=a(e,t);if(!n||n.length!==1)return false;var r,i=[],o=n[0].parentNode;for(r=0;r<o.cells.length;r++){i.push(o.cells[r])}return N(e,t,i)}function b(e,t){var l=a(e,t);if(!l||l.length!==1)return false;var s,d,f=[],c=n(t),u=i(r(l[0],c));for(s=0;s<c.length;s++){for(d=u.minCol;d<=u.minCol;d++){f=o(f,c[s][d],t)}}return N(e,t,f)}function C(e,n){var r=a(e,n);if(!r||r.length!=1)return false;var i,o,l=0,s,d,f,c=r[0].colSpan,u=r[0].parentNode;for(i=0;i<=r[0].cellIndex;i++)l+=u.cells[i].colSpan;if(c>1){r[0].colSpan--}else{for(o=0;o<n.rows.length;o++){if(o==u.rowIndex)continue;s=0;d=n.rows[o];i=0;while(s<l&&i<d.cells.length)s+=d.cells[i++].colSpan;d.cells[--i].colSpan+=1}}f=u.insertCell(r[0].cellIndex+1);f.rowSpan=r[0].rowSpan;f.innerHTML=t}function x(e,i){var o=a(e,i);if(!o||o.length!=1)return false;var l,s,d,f,c,u,m,h,g=n(i),N=r(o[0],g),p=o[0].parentNode,v=p.rowIndex,B=o[0].cellIndex,b=N[0].r,C=N[0].c,x=true,I=true;for(l=1;l<N.length;l++){if(N[l].r!=b)I=false;if(N[l].c!=C)x=false}if(I){var S=i.insertRow(p.rowIndex+1),y=S.insertCell(-1);y.innerHTML=t;if(!x)y.colSpan=o[0].colSpan;for(s=0;s<=b;s++){f=i.rows[s];for(d=0;d<f.cells.length;d++){c=f.cells[d];if(s==v&&d==B)continue;m=s;if(c.rowSpan>1)m+=c.rowSpan-1;if(m>=b)c.rowSpan++}}}else{f=i.rows[v+--o[0].rowSpan];h=false;for(d=0;d<f.cells.length;d++){u=r(f.cells[d],g);for(l=0;l<u.length;l++){if(u[l].c>B)h=0;else if(u[l].c+1==B)h=f.cells[d].cellIndex+1;if(h!==false)break}}y=f.insertCell(h);y.innerHTML=t;if(!x)y.colSpan=o[0].colSpan}}function I(e,t){var i=a(e,t);if(!i||i.length!=1)return false;var o=i[0];if(!o)return false;var l,s,d=n(t),f=r(o,d),c;for(c=0;c<d.length;c++){s=d[c][f[0].c];if(s&&s.parentNode){l=s.parentNode;BX.remove(s);if(l.cells.length==0)BX.remove(l)}}if(t.rows.length==0)BX.remove(t)}function S(e,t){var n=a(e,t);if(!n||n.length!=1)return false;var r=n[0];if(!r)return false;BX.remove(r.parentNode);if(t.rows.length==0)BX.remove(t)}function y(e,t,n){if(!n){var r=a(e,t);if(!r||r.length!=1)return false;n=r[0]}if(!n)return false;var i=n.parentNode;BX.remove(n);if(i.cells.length==0)BX.remove(i);if(t.rows.length==0)BX.remove(t)}function T(e,t){var n=a(e,t);if(!n||n.length==1)return false;var r,i;for(r=0;r<n.length;r++){i=n[r].parentNode;BX.remove(n[r]);if(i.cells.length==0)BX.remove(i)}if(t.rows.length==0)BX.remove(t)}return{exec:function(e,t){var n=t.range.commonAncestorContainer;switch(t.actionType){case"insertColumnLeft":case"insertColumnRight":s(n,t.tableNode,t.actionType);break;case"insertRowUpper":case"insertRowLower":d(n,t.tableNode,t.actionType);break;case"insertCellLeft":case"insertCellRight":f(n,t.tableNode,t.actionType);break;case"removeColumn":I(t.range,t.tableNode);break;case"removeRow":S(t.range,t.tableNode);break;case"removeCell":y(t.range,t.tableNode);break;case"removeSelectedCells":T(t.range,t.tableNode);break;case"mergeSelectedCells":N(t.range,t.tableNode);break;case"mergeRightCell":p(t.range,t.tableNode);break;case"mergeBottomCell":v(t.range,t.tableNode);break;case"mergeRow":B(t.range,t.tableNode);break;case"mergeColumn":b(t.range,t.tableNode);break;case"splitHorizontally":C(t.range,t.tableNode);break;case"splitVertically":x(t.range,t.tableNode);break}},state:BX.DoNothing,value:BX.DoNothing,getSelectedCells:a,canBeMerged:m,canBeMergedWithRight:h,canBeMergedWithBottom:g}},GetFormatBbCode:function(){var e=this;return{view:"textarea",exec:function(t,n){var r=n.value,i=n.tag.toUpperCase(),o=i;if(i=="FONT"||i=="COLOR"||i=="SIZE"){i+="="+r}e.editor.textareaView.WrapWith("["+i+"]","[/"+o+"]")},state:BX.DoNothing,value:BX.DoNothing}}};window.BXEditorActions=e})();
//# sourceMappingURL=html-actions.map.js