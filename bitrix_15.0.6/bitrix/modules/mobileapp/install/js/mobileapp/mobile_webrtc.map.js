{"version":3,"file":"mobile_webrtc.min.js","sources":["mobile_webrtc.js"],"names":["MobileWebrtc","this","siteDir","mobileSiteDir","signalingLink","initiator","callUserId","eventTimeRange","incomingCallTimeOut","delayedIncomingCall","incomingCallTimeOutId","callBackUserId","callChatId","callToGroup","waitTimeout","callGroupUsers","callInit","callActive","ready","pcStart","connected","sessionDescription","remoteSessionDescription","iceCandidates","iceCandidatesToSend","iceCandidateTimeout","peerConnectionInited","userId","BX","message","utcOffest","localStorage","get","ajax","url","method","dataType","timeout","async","onsuccess","proxy","json","localUtcTimeStamp","Math","round","Date","getTime","server_utc_time","set","onfailure","webrtc","setEventListeners","onAnswer","onDecline","onCallback","onClose","onUserMediaSuccess","onDisconnect","onPeerConnectionCreated","onIceCandidateDiscovered","onLocalSessionDescriptionCreated","onIceConnectionStateChanged","onIceGatheringStateChanged","onSignalingStateChanged","onError","prototype","callInvite","video","repeat","chatId","senderId","clearDelayedCallData","callVideo","isRepeatCall","ajaxCall","COMMAND","CHAT_ID","CHAT","VIDEO","delegate","params","ERROR","resetState","finishDialog","bitrix_sessid","BITRIX_SESSID","app","BasicAuth","success","CALL_TO_GROUP","UI","show","state","OUTGOING_CALL","data","recipient","avatar","name","caller","showIncomingCall","callCommand","INCOMING_CALL","clearTimeout","isMobile","callSignaling","userID","RECIPIENT_ID","PEER","JSON","stringify","command","parseInt","PARAMS","close","signalingPeerData","peerData","signal","parse","type","createPeerConnection","setRemoteDescription","addIceCandidates","candidates","i","length","push","reqParam","reqData","getUTCoffset","getTimeDiff","utcDate","localTimestamp","incomingTimestamp","abs","timesUp","ACTIVE","INITIATOR","CONVERSATION","getUserMedia","label","candidate","sdpMLineIndex","id","sdpMid","setTimeout","onIceCandidate","createOffer","createAnswer","sdp","showLocalVideo","errorData","window","mwebrtc","addCustomEvent","isTooLate","SERVER_TIME","FAIL_CALL","peer","onReconnect"],"mappings":"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"}